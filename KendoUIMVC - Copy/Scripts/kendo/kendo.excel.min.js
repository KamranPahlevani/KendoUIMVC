/*
* Kendo UI v2014.3.1119 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(t,define){define(["./kendo.core.min","./kendo.data.min"],t)}(function(){return function(t,e){e.ExcelExporter=e.Class.extend({init:function(n){n.columns=this._trimColumns(n.columns||[]),this.columns=t.map(this._leafColumns(n.columns||[]),this._prepareColumn),this.options=n;var i=n.dataSource;this.dataSource=i instanceof e.data.DataSource?new i.constructor(t.extend({},i.options,{page:n.allPages?0:i.page(),filter:i.filter(),pageSize:n.allPages?i.total():i.pageSize(),sort:i.sort(),group:i.group(),aggregate:i.aggregate()})):e.data.DataSource.create(i),i instanceof e.data.TreeListDataSource&&this.dataSource.data(i.view().toJSON())},_trimColumns:function(e){var n=this;return t.grep(e,function(t){var e=!(!t.field||t.hidden);return!e&&t.columns&&(e=n._trimColumns(t.columns).length>0),e})},_leafColumns:function(t){var e,n=[];for(e=0;t.length>e;e++)t[e].columns?n=n.concat(this._leafColumns(t[e].columns)):n.push(t[e]);return n},workbook:function(){var e=this.dataSource.fetch();return e.then(t.proxy(function(){return{sheets:[{columns:this._columns(),rows:this._rows(),freezePane:this._freezePane(),filter:this._filter()}]}},this))},_prepareColumn:function(n){return n.field&&!n.hidden?t.extend({},n,{groupHeaderTemplate:e.template(n.groupHeaderTemplate||"${title}: ${value}"),groupFooterTemplate:n.groupFooterTemplate?e.template(n.groupFooterTemplate):null,footerTemplate:n.footerTemplate?e.template(n.footerTemplate):null}):void 0},_filter:function(){if(!this.options.filterable)return null;var t=this._depth();return{from:t,to:t+this.columns.length-1}},_dataRows:function(e,n){var i=this._depth(),o=t.map(e,t.proxy(function(e){var o,r,a,s,l,c,h,d;return this._hierarchical()&&(n=this.dataSource.level(e)+1),o=t.map(Array(n),function(){return{background:"#dfdfdf",color:"#333"}}),i&&e.items?(r=t.grep(this.columns,function(t){return t.field==e.field})[0],a=r&&r.title?r.title:e.field,s=r?r.groupHeaderTemplate:null,l=a+": "+e.value,c=t.extend({title:a,field:e.field,value:e.value,aggregates:e.aggregates},e.aggregates[e.field]),s&&(l=s(c)),o.push({value:l,background:"#dfdfdf",color:"#333",colSpan:this.columns.length+i-n}),h=this._dataRows(e.items,n+1),h.unshift({type:"group-header",cells:o}),h.concat(this._footer(e,n+1))):(d=t.map(this.columns,t.proxy(this._cell,this,e)),this._hierarchical()&&(d[0].colSpan=i-n+1),{type:"data",cells:o.concat(d)})},this));return o},_footer:function(e,n){var i=[],o=!1,r=t.map(this.columns,function(t){return t.groupFooterTemplate?(o=!0,{background:"#dfdfdf",color:"#333",value:t.groupFooterTemplate(e.aggregates[t.field])}):{background:"#dfdfdf",color:"#333"}});return o&&i.push({type:"group-footer",cells:t.map(Array(n),function(){return{background:"#dfdfdf",color:"#333"}}).concat(r)}),i},_isColumnVisible:function(t){return this._visibleColumns([t]).length>0&&(t.field||t.columns)},_visibleColumns:function(e){var n=this;return t.grep(e,function(t){var e=!t.hidden;return e&&t.columns&&(e=n._visibleColumns(t.columns).length>0),e})},_headerRow:function(e,n){var i=t.map(e.cells,function(t){return{background:"#7a7a7a",color:"#fff",value:t.title,colSpan:t.colSpan>1?t.colSpan:1,rowSpan:e.rowSpan>1&&!t.colSpan?e.rowSpan:1}});return this._hierarchical()&&(i[0].colSpan=this._depth()+1),{type:"header",cells:t.map(Array(n.length),function(){return{background:"#7a7a7a",color:"#fff"}}).concat(i)}},_prependHeaderRows:function(t){var e,n=this.dataSource.group(),i=[{rowSpan:1,cells:[],index:0}];for(this._prepareHeaderRows(i,this.options.columns),e=i.length-1;e>=0;e--)t.unshift(this._headerRow(i[e],n))},_prepareHeaderRows:function(t,e,n,i){var o,r,a,s=i||t[t.length-1],l=t[s.index+1],c=0;for(a=0;e.length>a;a++)o=e[a],this._isColumnVisible(o)&&(r={title:o.title||o.field,colSpan:0},s.cells.push(r),o.columns&&o.columns.length&&(l||(l={rowSpan:0,cells:[],index:t.length},t.push(l)),r.colSpan=this._trimColumns(this._visibleColumns(o.columns)).length,this._prepareHeaderRows(t,o.columns,r,l),c+=r.colSpan-1,s.rowSpan=t.length-s.index));n&&(n.colSpan+=c)},_rows:function(){var e,n,i=this.dataSource.group(),o=this._dataRows(this.dataSource.view(),0);return this.columns.length&&(this._prependHeaderRows(o),e=!1,n=t.map(this.columns,t.proxy(function(t){return t.footerTemplate?(e=!0,{background:"#dfdfdf",color:"#333",value:t.footerTemplate(this.dataSource.aggregates()[t.field])}):{background:"#dfdfdf",color:"#333"}},this)),e&&o.push({type:"footer",cells:t.map(Array(i.length),function(){return{background:"#dfdfdf",color:"#333"}}).concat(n)})),o},_headerDepth:function(t){var e,n,i=1,o=0;for(e=0;t.length>e;e++)t[e].columns&&(n=this._headerDepth(t[e].columns),n>o&&(o=n));return i+o},_freezePane:function(){var e=this._visibleColumns(this.options.columns||[]),n=this._trimColumns(this._leafColumns(t.grep(e,function(t){return t.locked}))).length;return{rowSplit:this._headerDepth(e),colSplit:n?n+this.dataSource.group().length:0}},_cell:function(t,e){return e.field?{value:t.get(e.field)}:void 0},_hierarchical:function(){return this.options.hierarchy&&this.dataSource.level},_depth:function(){var t,e,n,i=this.dataSource,o=0;if(this._hierarchical()){for(t=i.view(),e=0;t.length>e;e++)n=i.level(t[e]),n>o&&(o=n);o++}else o=i.group().length;return o},_columns:function(){var e=this._depth(),n=t.map(Array(e),function(){return{width:20}});return n.concat(t.map(this.columns,function(t){return{width:parseInt(t.width,10),autoWidth:t.width?!1:!0}}))}}),e.ExcelMixin={extend:function(e){e.events.push("excelExport"),e.options.excel=t.extend(e.options.excel,this.options),e.saveAsExcel=this.saveAsExcel},options:{proxyURL:"",allPages:!1,filterable:!1,fileName:"Export.xlsx"},saveAsExcel:function(){var n=this.options.excel||{},i=new e.ExcelExporter({columns:this.columns,dataSource:this.dataSource,allPages:n.allPages,filterable:n.filterable,hierarchy:n.hierarchy});i.workbook().then(t.proxy(function(t){if(!this.trigger("excelExport",{workbook:t})){var i=new e.ooxml.Workbook(t);e.saveAs({dataURI:i.toDataURL(),fileName:t.fileName||n.fileName,proxyURL:n.proxyURL,forceProxy:n.forceProxy})}},this))}}}(kendo.jQuery,kendo),window.kendo},"function"==typeof define&&define.amd?define:function(t,e){e()});