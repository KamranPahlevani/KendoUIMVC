/*
* Kendo UI v2015.2.902 (http://www.telerik.com/kendo-ui)
* Copyright 2015 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(e,define){define(["./kendo.dom.min","./kendo.data.min"],e)}(function(){return function(e,t){function n(e){var n="string"==typeof e?[{name:e}]:e,i="[object Array]"===vt.call(n)?n:n!==t?[n]:[];return wt(i,function(e){return"string"==typeof e?{name:e}:{name:e.name,type:e.type}})}function i(e){var n="string"==typeof e?[{name:[e],expand:!1}]:e,i="[object Array]"===vt.call(n)?n:n!==t?[n]:[];return wt(i,function(e){return"string"==typeof e?{name:[e],expand:!1}:{name:"[object Array]"===vt.call(e.name)?e.name.slice():[e.name],expand:e.expand}})}function o(e,t,n,i){var r,a,s,l;if(n||(n=t),i||(i=0),l=n.members[i],l&&!l.measure){if(s=l.children,a=s.length,n===t?e[ut.stringify([l.name])]=!!a:a&&(e[ut.stringify(at(n,i))]=!0),a)for(r=0;a>r;r++)o(e,t,s[r],i);o(e,t,n,i+1)}}function r(t){var n,i,r={};t.length&&o(r,t[0]),n=[];for(i in r)n.push({name:e.parseJSON(i),expand:r[i]});return n}function a(e,t){var n,i,o,r,a=t.tuples||[],s=a[0];if(s&&s.members.length>e.length)for(n=s.members,i=0;n.length>i;i++)if(!n[i].measure){for(o=!1,r=0;e.length>r;r++)if(0===F(e[r]).indexOf(n[i].hierarchy)){o=!0;break}o||e.push({name:[n[i].name],expand:!1})}}function s(e){var t,n=[],i=e.members;for(t=0;i.length>t;t++)i[t].measure||n.push({name:[i[t].name],expand:i[t].children.length>0});return n}function l(e,t,n){var o,r;return e=e||{},a(t,e),n.length>1&&t.push({name:Ct,measure:!0,children:i(n)}),o={members:t},e.tuples&&(r=b(e.tuples,o),r.tuple&&(t=s(r.tuple))),t}function c(e){var t=ut.getter(e.field,!0);return function(n,i){return e.aggregate(t(n.dataItem),i,n)}}function d(e){return"number"==typeof e&&!isNaN(e)}function h(e){return e&&e.getTime}function u(e,n,i){return e.tuples.length<m(n.tuples,i)?n:t}function f(e,t,n,i,o){var r,a,s,l=e.length,c=m(t,i),d=i.length||1;for(a=0;n>a;a++)for(r=0;l>r;r++)s=g(e[r],t)*d,s+=r%d,o[a*l+r].ordinal=a*c+s}function p(e,t,n,i,o){var r,a,s,l=e.length,c=(m(t,i),i.length||1);for(a=0;l>a;a++)for(s=g(e[a],t),s*=c,s+=a%c,r=0;n>r;r++)o[a*n+r].ordinal=s*n+r}function g(e,t){return b(t,e).index}function m(e,t){var n,i,o;if(!e.length)return 0;for(n=e.slice(),i=n.shift(),o=1;i;)i.members?[].push.apply(n,i.members):i.children&&(i.measure||(o+=i.children.length),[].push.apply(n,i.children)),i=n.shift();return t.length&&(o*=t.length),o}function v(e){return e||(e={tuples:[]}),e.tuples||(e.tuples=[]),e}function _(e,t,n){var i,o,r,a;if(!e)return 0;for(i=Math.max(n.length,1),o=e.members.slice(0,t),r=i,a=o.shift(),i>1&&(i+=1);a;)a.name===Ct?r+=i:a.children?[].push.apply(o,a.children):(r++,[].push.apply(o,a.members)),a=o.shift();return r}function w(e,t,n){var i,o,r,a,s,l;if(!t[0])return{parsedRoot:null,tuples:e,memberIndex:0,index:0};if(i=b(e,t[0]),!i.tuple)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};if(o=i.tuple.members,r=t[0].members,a=-1,o.length!==r.length)return{parsedRoot:null,tuples:t,memberIndex:0,index:0};for(s=0,l=o.length;l>s;s++)!o[s].measure&&r[s].children[0]&&(-1==a&&r[s].children.length&&(a=s),o[s].children=r[s].children);return n=Math.max(n.length,1),{parsedRoot:i.tuple,index:i.index*n,memberIndex:a,tuples:e}}function y(e,t){var n,i,o=!0;for(e=e.members,t=t.members,n=0,i=e.length;i>n;n++)e[n].measure||t[n].measure||(o=o&&F(e[n])===F(t[n]));return o}function b(e,t){var n,i,o,r,a,s,l,c=0;for(n=0,i=e.length;i>n;n++){if(o=e[n],y(o,t))return{tuple:o,index:c};for(c++,a=0,s=o.members.length;s>a;a++)if(l=o.members[a],!l.measure&&(r=b(l.children,t),c+=r.index,r.tuple))return{tuple:r.tuple,index:c}}return{index:c}}function x(e,t){var n,i,o,r="";for(i=0,o=e.length;o>i;i++)n=e[i],r+=n.name,t[r]||(t[r]=n)}function k(e,t){var n,i,o,r,a=e.members,s="",l="";for(n=0,i=a.length;i>n;n++){if(o=a[n],r){if(t[s+o.name]){s+=o.name,r=t[s];continue}return t[s+o.parentName]?t[s+o.parentName]:t[l+o.parentName]?t[l+o.parentName]:t[l]}if(s+=o.name,r=t[o.parentName],!r&&(r=t[s],!r))return null;r&&(l+=r.name)}return r}function C(e,t){var n,i,o,r;if(0===t.length)return-1;for(n=t[0],i=e.members,o=0,r=i.length;r>o;o++)if(i[o].name==n.name)return o}function S(n,i){if(!(0>i)){var o={name:Ct,measure:!0,children:[e.extend({members:[],dataIndex:n.dataIndex},n.members[i])]};n.members.splice(i,1,o),n.dataIndex=t}}function T(e,t){var n,i,o,r,a,s;if(1>e.length)return[];for(n=[],i={},o=C(e[0],t),r=0;e.length>r;r++)a=e[r],a.dataIndex=r,S(a,o),s=k(a,i),s?s.children.push(0>o||!s.measure?a:a.members[o].children[0]):n.push(a),x(a.members,i);return n}function D(e,t){var n,i,o,r,a,s,l,c,d;if(!e||!e.length)return t;for(n=[],i=P(e),o=i.length,r=Math.max(t.length/o,1),a=0;o>a;a++)for(l=r*a,c=r*i[a],s=0;r>s;s++)d=parseInt(c+s,10),n[parseInt(l+s,10)]=t[d]||{value:"",fmtValue:"",ordinal:d};return n}function A(e,t){var n,i,o,r,a,s,l,c;if(!e||!e.length)return t;for(n=[],i=P(e),o=i.length,r=Math.max(t.length/o,1),s=0;r>s;s++)for(l=o*s,a=0;o>a;a++)c=i[a]+l,n[l+a]=t[c]||{value:"",fmtValue:"",ordinal:c};return n}function P(e){var n,i,o,r,a,s,l;for(e=e.slice(),n=[],i=e.shift();i;){for(i.dataIndex!==t&&n.push(i.dataIndex),a=0,o=0,r=i.members.length;r>o;o++)l=i.members[o],s=l.children,l.measure?[].splice.apply(e,[0,0].concat(s)):[].splice.apply(e,[a,0].concat(s)),a+=s.length;i=e.shift()}return n}function E(e){var t=e.split(".");return t.length>2?t[0]+"."+t[1]:e}function M(e,t){var n=e.length-1,i=e[n],o=I(t,i);return o&&o.dir?i="ORDER("+i+".Children,"+o.field+".CurrentMember.MEMBER_CAPTION,"+o.dir+")":i+=".Children",e[n]=i,e}function I(e,t){for(var n=0,i=e.length;i>n;n++)if(0===t.indexOf(e[n].field))return e[n];return null}function B(e){var t,n="CROSSJOIN({";return e.length>2?(t=e.pop(),n+=B(e)):(n+=e.shift(),t=e.pop()),n+="},{",n+=t,n+="})"}function z(e,t){var n=e.slice(0);return t.length>1&&n.push("{"+L(t).join(",")+"}"),B(n)}function L(e){for(var n,i=0,o=e.length,r=[];o>i;i++)n=e[i],r.push(n.name!==t?n.name:n);return r}function F(e){return e=e.name||e,"[object Array]"===vt.call(e)&&(e=e[e.length-1]),e}function R(e){for(var t=e.length,n=[],i=0;t>i;i++)n.push(e[i].name[0]);return n}function O(e,t){var n,i,o,r=0,a=e.length,s=t.length;for(t=t.slice(0);a>r;r++)for(n=e[r],o=0;s>o;o++)if(i=E(t[o]),-1!==n.indexOf(i)){t[o]=n;break}return{names:t,expandedIdx:o,uniquePath:t.slice(0,o+1).join("")}}function N(e){for(var t,n,i,o,r,a,s=[],l=[],c=[],d=0,h=e.length;h>d;d++)if(t=e[d],o=t.name,a=!1,"[object Array]"!==vt.call(o)&&(t.name=o=[o]),o.length>1)l.push(t);else{for(r=E(o[0]),n=0,i=c.length;i>n;n++)if(0===c[n].name[0].indexOf(r)){a=!0;break}a||c.push(t),t.expand&&s.push(t)}return s=s.concat(l),{root:c,expanded:s}}function H(e,t,n){var i,o,r,a,s,l,c,d,h="";if(e=e||[],i=N(e),o=i.root,r=R(o),a=[],i=i.expanded,s=i.length,l=0,d=[],r.length>1||t.length>1){for(a.push(z(r,t));s>l;l++)c=M(i[l].name,n),d=O(c,r).names,a.push(z(d,t));h+=a.join(",")}else{for(;s>l;l++)c=M(i[l].name,n),d.push(c[0]);h+=r.concat(d).join(",")}return h}function V(e){var t="",n=e.value,i=e.field,o=e.operator;return"in"==o?(t+="{",t+=n,t+="}"):(t+="Filter(",t+=i+".MEMBERS",t+=ut.format(q[o],i,n),t+=")"),t}function U(e,t){var n,i,o="",r=e.filters,a=r.length;for(i=a-1;i>=0;i--)n="SELECT (",n+=V(r[i]),n+=") ON 0",i==a-1?(n+=" FROM ["+t+"]",o=n):o=n+" FROM ( "+o+" )";return o}function W(e,t,n){var i,o,r="";if(t){r+="<"+e+">";for(o in t)i=t[o],n&&(o=o.replace(/([A-Z]+(?=$|[A-Z][a-z])|[A-Z]?[a-z]+)/g,"$1_").toUpperCase().replace(/_$/,"")),r+="<"+o+">"+i+"</"+o+">";r+="</"+e+">"}else r+="<"+e+"/>";return r}function j(e){if(null==e)return[];var t=vt.call(e);return"[object Array]"!==t?[e]:e}function G(e){var t,n,i,o,r={tuples:[]},a=j(ut.getter("Tuples.Tuple",!0)(e)),s=ut.getter("Caption['#text']"),l=ut.getter("UName['#text']"),c=ut.getter("LName['#text']"),d=ut.getter("LNum['#text']"),h=ut.getter("CHILDREN_CARDINALITY['#text']",!0),u=ut.getter("['@Hierarchy']"),f=ut.getter("PARENT_UNIQUE_NAME['#text']",!0);for(t=0;a.length>t;t++){for(n=[],i=j(a[t].Member),o=0;i.length>o;o++)n.push({children:[],caption:s(i[o]),name:l(i[o]),levelName:c(i[o]),levelNum:d(i[o]),hasChildren:parseInt(h(i[o]),10)>0,parentName:f(i[o]),hierarchy:u(i[o])});r.tuples.push({members:n})}return r}var q,$,Y,Q,X,K,Z,J,et,tt,nt,it,ot,rt,at,st,lt,ct,dt,ht,ut=window.kendo,ft=ut.ui,pt=ut.Class,gt=ft.Widget,mt=ut.data.DataSource,vt={}.toString,_t=function(e){return e},wt=e.map,yt=e.extend,bt=ut.isFunction,xt="change",kt="error",Ct="Measures",St="progress",Tt="stateReset",Dt="auto",At="<div/>",Pt=".kendoPivotGrid",Et="__row_total__",Mt="dataBinding",It="dataBound",Bt="expandMember",zt="collapseMember",Lt="k-i-arrow-s",Ft="k-i-arrow-e",Rt="<span>#: data.member.caption || data.member.name #</span>",Ot='<span class="k-icon k-i-kpi-#=data.dataItem.value > 0 ? "open" : data.dataItem.value < 0 ? "denied" : "hold"#">#:data.dataItem.value#</span>',Nt='<span class="k-icon k-i-kpi-#=data.dataItem.value > 0 ? "increase" : data.dataItem.value < 0 ? "decrease" : "equal"#">#:data.dataItem.value#</span>',Ht='#= data.dataItem ? kendo.htmlEncode(data.dataItem.fmtValue || data.dataItem.value) || "&nbsp;" : "&nbsp;" #',Vt='<table class="k-pivot-layout"><tr><td><div class="k-pivot-rowheaders"></div></td><td><div class="k-pivot-table k-state-default"></div></td></tr></table>',Ut={sum:function(e,t){var n=t.accumulator;return d(n)?d(e)&&(n+=e):n=e,n},count:function(e,t){return(t.accumulator||0)+1},average:{aggregate:function(e,n){var i=n.accumulator;return n.count===t&&(n.count=0),d(i)?d(e)&&(i+=e):i=e,d(e)&&n.count++,i},result:function(e){var t=e.accumulator;return d(t)&&(t/=e.count),t}},max:function(e,t){var n=t.accumulator;return d(n)||h(n)||(n=e),e>n&&(d(e)||h(e))&&(n=e),n},min:function(e,t){var n=t.accumulator;return d(n)||h(n)||(n=e),n>e&&(d(e)||h(e))&&(n=e),n}},Wt=pt.extend({init:function(e){this.options=yt({},this.options,e),this.dimensions=this._normalizeDescriptors("field",this.options.dimensions),this.measures=this._normalizeDescriptors("name",this.options.measures)},_normalizeDescriptors:function(e,t){var n,i,o,r;if(t=t||{},n={},"[object Array]"===vt.call(t)){for(o=0,r=t.length;r>o;o++)i=t[o],"string"==typeof i?n[i]={}:i[e]&&(n[i[e]]=i);t=n}return t},_rootTuples:function(e,n){var i,o,r,a,s=n.length||1,l=this.dimensions||[],c=0,d=e.length,h=[],u=[];if(d||n.length){for(c=0;s>c;c++){for(i={members:[]},a=0;d>a;a++)o=e[a],r=o.split("&"),i.members[i.members.length]={children:[],caption:(l[o]||{}).caption||"All",name:o,levelName:o,levelNum:"0",hasChildren:!0,parentName:r.length>1?r[0]:t,hierarchy:o};s>1&&(i.members[i.members.length]={children:[],caption:n[c].caption,name:n[c].descriptor.name,levelName:"MEASURES",levelNum:"0",hasChildren:!1,parentName:t,hierarchy:"MEASURES"}),h[h.length]=i}u.push(Et)}return{keys:u,tuples:h}},_expandedTuples:function(e,n,i){var o,r,a,s,l,c,d,h,u,f,p,g=i.length||1,m=this.dimensions||[],v=[],_=[];for(a in e){for(s=e[a],d=this._findExpandedMember(n,s.uniquePath),l=v[d.index]||[],c=_[d.index]||[],h=d.member.names,o=0;g>o;o++){for(r={members:[]},p=0;h.length>p;p++)p===d.member.expandedIdx?(r.members[r.members.length]={children:[],caption:s.value,name:s.name,hasChildren:!1,levelNum:1,levelName:s.parentName+s.name,parentName:s.parentName,hierarchy:s.parentName+s.name},0===o&&c.push(at(r,p).join(""))):(f=h[p],u=f.split("&"),r.members[r.members.length]={children:[],caption:(m[f]||{}).caption||"All",name:f,levelName:f,levelNum:"0",hasChildren:!0,parentName:u.length>1?u[0]:t,hierarchy:f});g>1&&(r.members[r.members.length]={children:[],caption:i[o].caption,name:i[o].descriptor.name,levelName:"MEASURES",levelNum:"0",hasChildren:!0,parentName:t,hierarchy:"MEASURES"}),l[l.length]=r}v[d.index]=l,_[d.index]=c}return{keys:_,tuples:v}},_findExpandedMember:function(e,t){for(var n=0;e.length>n;n++)if(e[n].uniquePath===t)return{member:e[n],index:n}},_asTuples:function(e,t,n){var i,o;return n=n||[],i=this._rootTuples(t.root,n),o=this._expandedTuples(e,t.expanded,n),{keys:[].concat.apply(i.keys,o.keys),tuples:[].concat.apply(i.tuples,o.tuples)}},_measuresInfo:function(e,t){for(var n,i,o=0,r=e&&e.length,a=[],s={},l={},c=this.measures||{};r>o;o++)i=e[o].descriptor.name,n=c[i]||{},a.push(i),n.result&&(s[i]=n.result),n.format&&(l[i]=n.format);return{names:a,formats:l,resultFuncs:s,rowAxis:t}},_toDataArray:function(e,t,n,i){var o,r,a,s,l,c,d,h,u,f,p=[],g=1,m=[],v=n.length||1,_=i.length||1;for(t.rowAxis?(m=t.names,g=m.length):f=t.names,a=0;v>a;a++)for(d=e[n[a]||Et],c=0;g>c;c++)for(t.rowAxis&&(f=[m[c]]),s=0;_>s;s++)for(u=i[s]||Et,h=d.items[u],o=u===Et?d.aggregates:h?h.aggregates:{},l=0;f.length>l;l++)r=f[l],this._addData(p,o[r],t.formats[r],t.resultFuncs[r]);return p},_addData:function(e,t,n,i){var o,r="";t&&(t=i?i(t):t.accumulator,r=n?ut.format(n,t):t),o=e.length,e[o]={ordinal:o,value:t||"",fmtValue:r}},_matchDescriptors:function(e,n,i){for(var o,r,a,s,l=n.names,c=n.expandedIdx;c>0;)if(o=l[--c].split("&"),o.length>1&&(r=o[0],a=o[1],s=i[r](e),s=s!==t&&null!==s?""+s:s,s!=a))return!1;return!0},_calculateAggregate:function(e,t,n){var i,o,r,a={};for(r=0;e.length>r;r++)o=e[r].descriptor.name,i=n.aggregates[o]||{},i.accumulator=e[r].aggregator(t,i),a[o]=i;return a},_processColumns:function(e,n,i,o,r,a,s,l){for(var c,d,h,u,f,p,g,m,v=r.dataItem,_=0;n.length>_;_++)d=n[_],this._matchDescriptors(v,d,i)&&(m=d.names.slice(0,d.expandedIdx).join(""),p=d.names[d.expandedIdx],c=i[p](v),c=c!==t&&null!==c?""+c:c,g=p,p=p+"&"+c,f=m+p,h=o[f]||{index:s.columnIndex,parentName:g,name:p,uniquePath:m+g,value:c},u=a.items[f]||{aggregates:{}},a.items[f]={index:h.index,aggregates:this._calculateAggregate(e,r,u)},l&&(o[f]||s.columnIndex++,o[f]=h))},_measureAggregators:function(e){var t,n,i,o,r,a,s=e.measures||[],l=this.measures||{},d=[];if(s.length){for(i=0,o=s.length;o>i;i++)if(t=s[i],n=l[t.name],r=null,n){if(a=n.aggregate,"string"==typeof a){if(r=Ut[a.toLowerCase()],!r)throw Error("There is no such aggregate function");n.aggregate=r.aggregate||r,n.result=r.result}d.push({descriptor:t,caption:n.caption,result:n.result,aggregator:c(n)})}}else d.push({descriptor:{name:"default"},caption:"default",aggregator:function(){return 1}});return d},_normalizeName:function(e){return-1!==e.indexOf(" ")&&(e='["'+e+'"]'),e},_buildGetters:function(e){var t,n,i,o={};for(i=0;e.length>i;i++)n=e[i],t=n.split("&"),t.length>1?o[t[0]]=ut.getter(t[0],!0):o[n]=ut.getter(this._normalizeName(n),!0);return o},_parseDescriptors:function(e){var t,n=N(e),i=R(n.root),o=n.expanded,r=[];for(t=0;o.length>t;t++)r.push(O(o[t].name,i));return{root:i,expanded:r}},process:function(e,n){var o,r,a,s,l,c,d,h,u,f,p,g,m,v,_,w,y,b,x,k,C,S,T,D,A,P,E,M,I,B;if(e=e||[],n=n||{},o=n.measures||[],r="rows"===n.measuresAxis,a=n.columns||[],s=n.rows||[],!a.length&&s.length&&(!o.length||o.length&&r)&&(a=s,s=[],r=!1),a.length||s.length||(r=!1),!a.length&&o.length&&(a=i(n.measures)),a=this._parseDescriptors(a),s=this._parseDescriptors(s),l={},c={},d={},u={columnIndex:0},f=this._measureAggregators(n),p=this._buildGetters(a.root),g=this._buildGetters(s.root),m=!1,v=a.expanded,_=s.expanded,b=0!==_.length,I=e.length,B=0,a.root.length||s.root.length)for(m=!0,B=0;I>B;B++)for(w=e[B],y={dataItem:w,index:B},S=l[Et]||{items:{},aggregates:{}},this._processColumns(f,v,p,c,y,S,u,!b),S.aggregates=this._calculateAggregate(f,y,S),l[Et]=S,x=0;_.length>x;x++)k=_[x],this._matchDescriptors(w,k,g)?(D=k.names.slice(0,k.expandedIdx).join(""),C=k.names[k.expandedIdx],A=C,h=g[C](w),h=h!==t?""+h:h,C=C+"&"+h,T=D+C,d[T]={uniquePath:D+A,parentName:A,name:C,value:h},P=l[T]||{items:{},aggregates:{}},this._processColumns(f,v,p,c,y,P,u,!0),P.aggregates=this._calculateAggregate(f,y,P),l[T]=P):this._processColumns(f,v,p,c,y,{items:{},aggregates:{}},u,!0);return m&&I?(!(f.length>1)||n.columns&&n.columns.length||(a={root:[],expanded:[]}),E=this._asTuples(c,a,r?[]:f),M=this._asTuples(d,s,r?f:[]),c=E.tuples,d=M.tuples,l=this._toDataArray(l,this._measuresInfo(f,r),M.keys,E.keys)):l=c=d=[],{axes:{columns:{tuples:c},rows:{tuples:d}},data:l}}}),jt=pt.extend({init:function(e,t){this.transport=t,this.options=t.options||{},this.transport.discover||bt(e.discover)&&(this.discover=e.discover)},read:function(e){return this.transport.read(e)},update:function(e){return this.transport.update(e)},create:function(e){return this.transport.create(e)},destroy:function(e){return this.transport.destroy(e)},discover:function(e){return this.transport.discover?this.transport.discover(e):(e.success({}),t)},catalog:function(n){var i,o=this.options||{};return n===t?(o.connection||{}).catalog:(i=o.connection||{},i.catalog=n,this.options.connection=i,e.extend(this.transport.options,{connection:i}),t)},cube:function(e){var n,i=this.options||{};return e===t?(i.connection||{}).cube:(n=i.connection||{},n.cube=e,this.options.connection=n,yt(!0,this.transport.options,{connection:n}),t)}}),Gt=mt.extend({init:function(t){var o,r=((t||{}).schema||{}).cube,a="columns",s={axes:_t,cubes:_t,catalogs:_t,measures:_t,dimensions:_t,hierarchies:_t,levels:_t,members:_t};r&&(s=e.extend(s,this._cubeSchema(r)),this.cubeBuilder=new Wt(r)),mt.fn.init.call(this,yt(!0,{},{schema:s},t)),this.transport=new jt(this.options.transport||{},this.transport),this._columns=i(this.options.columns),this._rows=i(this.options.rows),o=this.options.measures||[],"[object Object]"===vt.call(o)&&(a=o.axis||"columns",o=o.values||[]),this._measures=n(o),this._measuresAxis=a,this._skipNormalize=0,this._axes={}},_cubeSchema:function(e){return{dimensions:function(){var t,n=[],i=e.dimensions;for(t in i)n.push({name:t,caption:i[t].caption||t,uniqueName:t,defaultHierarchy:t,type:1});return e.measures&&n.push({name:Ct,caption:Ct,uniqueName:Ct,type:2}),n},hierarchies:function(){return[]},measures:function(){var t,n=[],i=e.measures;for(t in i)n.push({name:t,caption:t,uniqueName:t,aggregator:t});return n}}},options:{serverSorting:!0,serverPaging:!0,serverFiltering:!0,serverGrouping:!0,serverAggregates:!0},catalog:function(e){return e===t?this.transport.catalog():(this.transport.catalog(e),this._mergeState({}),this._axes={},this.data([]),t)},cube:function(e){return e===t?this.transport.cube():(this.transport.cube(e),this._axes={},this._mergeState({}),this.data([]),t)},axes:function(){return this._axes},columns:function(e){return e===t?this._columns:(this._skipNormalize+=1,this._clearAxesData=!0,this._columns=i(e),this.query({columns:e,rows:this.rowsAxisDescriptors(),measures:this.measures()}),t)},rows:function(e){return e===t?this._rows:(this._skipNormalize+=1,this._clearAxesData=!0,this._rows=i(e),this.query({columns:this.columnsAxisDescriptors(),rows:e,measures:this.measures()}),t)},measures:function(e){return e===t?this._measures:(this._skipNormalize+=1,this._clearAxesData=!0,this.query({columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:n(e)}),t)},measuresAxis:function(){return this._measuresAxis||"columns"},_expandPath:function(e,t){var n,o,r,a="columns"===t?"columns":"rows",s="columns"===t?"rows":"columns",c=i(e),d=F(c[c.length-1]);for(this._lastExpanded=a,c=l(this.axes()[a],c,this.measures()),n=0;c.length>n;n++)if(o=F(c[n]),o===d){if(c[n].expand)return;c[n].expand=!0}else c[n].expand=!1;r={},r[a]=c,r[s]=this._descriptorsForAxis(s),this._query(r)},_descriptorsForAxis:function(e){var t=this.axes(),n=this[e]()||[];return t&&t[e]&&t[e].tuples&&t[e].tuples[0]&&(n=r(t[e].tuples||[])),n},columnsAxisDescriptors:function(){return this._descriptorsForAxis("columns")},rowsAxisDescriptors:function(){return this._descriptorsForAxis("rows")},_process:function(e,t){this._view=e,t=t||{},t.items=t.items||this._view,this.trigger(xt,t)},_query:function(e){var t=this;return e||(this._skipNormalize+=1,this._clearAxesData=!0),t.query(yt({},{page:t.page(),pageSize:t.pageSize(),sort:t.sort(),filter:t.filter(),group:t.group(),aggregate:t.aggregate(),columns:this.columnsAxisDescriptors(),rows:this.rowsAxisDescriptors(),measures:this.measures()},e))},query:function(t){var n=this._mergeState(t);return this._data.length&&this.cubeBuilder?(this._params(n),this._updateLocalData(this._pristineData),e.Deferred().resolve().promise()):this.read(n)},_mergeState:function(e){return e=mt.fn._mergeState.call(this,e),e!==t&&(this._measures=n(e.measures),e.columns?e.columns=i(e.columns):e.columns||(this._columns=[]),e.rows?e.rows=i(e.rows):e.rows||(this._rows=[])),e},filter:function(e){return e===t?this._filter:(this._skipNormalize+=1,this._clearAxesData=!0,this._query({filter:e,page:1}),t)},expandColumn:function(e){this._expandPath(e,"columns")},expandRow:function(e){this._expandPath(e,"rows")},success:function(e){var t;this.cubeBuilder&&(t=(this.reader.data(e)||[]).slice(0)),mt.fn.success.call(this,e),t&&(this._pristineData=t)},_processResult:function(e,t){var n,i,o,r,a,s,l,c,d,h,g;return this.cubeBuilder&&(n=this.cubeBuilder.process(e,this._requestData),e=n.data,t=n.axes),c=this.columns(),d=this.rows(),h=t.columns&&t.columns.tuples,c.length||!d.length||!h||!this._rowMeasures().length&&this.measures().length||(t={columns:{},rows:t.columns}),c.length||d.length||"rows"!==this.measuresAxis()||!h||(t={columns:{},rows:t.columns}),this._axes={columns:v(this._axes.columns),rows:v(this._axes.rows)},t={columns:v(t.columns),rows:v(t.rows)},i=this._normalizeTuples(t.columns.tuples,this._axes.columns.tuples,c,this._columnMeasures()),o=this._normalizeTuples(t.rows.tuples,this._axes.rows.tuples,d,this._rowMeasures()),this._skipNormalize-=1,this.cubeBuilder||(e=this._normalizeData({columnsLength:t.columns.tuples.length,rowsLength:t.rows.tuples.length,columnIndexes:i,rowIndexes:o,data:e})),"rows"==this._lastExpanded?(r=t.columns.tuples,s=this._columnMeasures(),a=u(t.columns,this._axes.columns,s),a&&(l="columns",t.columns=a,f(r,a.tuples,t.rows.tuples.length,s,e),this.cubeBuilder||(e=this._normalizeData({columnsLength:m(t.columns.tuples,s),rowsLength:t.rows.tuples.length,data:e})))):"columns"==this._lastExpanded&&(r=t.rows.tuples,s=this._rowMeasures(),a=u(t.rows,this._axes.rows,s),a&&(l="rows",t.rows=a,p(r,a.tuples,t.columns.tuples.length,s,e),this.cubeBuilder||(e=this._normalizeData({columnsLength:m(t.rows.tuples,s),rowsLength:t.columns.tuples.length,data:e})))),this._lastExpanded=null,g=this._mergeAxes(t,e,l),this._axes=g.axes,g.data},_readData:function(e){var t=this.reader.axes(e),n=this.reader.data(e);return this._processResult(n,t)},_createTuple:function(e,t,n){var i,o,r,a,s,l,c,d,h=e.members,u=h.length,f={members:[]},p=0;for(t&&(u-=1);u>p;p++)d=h[p],o=+d.levelNum,r=d.name,a=d.parentName,c=d.caption||r,s=d.hasChildren,l=d.hierarchy,i=d.levelName,n&&(c="All",0===o?a=d.name:o-=1,s=!0,r=l=i=a),f.members.push({name:r,children:[],caption:c,levelName:i,levelNum:""+o,hasChildren:s,hierarchy:l,parentName:n?"":a});return t&&f.members.push({name:t.name,children:[]}),f},_hasRoot:function(e,t,n){var i,o,r,a,s,l,c;if(t.length)return b(t,e).tuple;for(i=e.members,a=!0,l=0,c=i.length;c>l;l++)if(o=i[l],s=+o.levelNum||0,r=n[l],!(0===s||r&&o.name===F(r))){a=!1;break}return a},_mergeAxes:function(e,t,n){var i,o,r,a,s,l=this._columnMeasures(),c=this._rowMeasures(),d=this.axes(),h=e.rows.tuples.length,u=m(d.columns.tuples,l),f=e.columns.tuples.length;return"columns"==n?(f=u,o=e.columns.tuples):(o=T(e.columns.tuples,l),t=A(o,t)),r=w(d.columns.tuples,o,l),"rows"==n?(h=m(e.rows.tuples,c),o=e.rows.tuples):(o=T(e.rows.tuples,c),t=D(o,t)),a=w(d.rows.tuples,o,c),d.columns.tuples=r.tuples,d.rows.tuples=a.tuples,u!==m(d.columns.tuples,l)?(i=r.index+_(r.parsedRoot,r.memberIndex,l),s=u+f,t=this._mergeColumnData(t,i,h,f,s)):(i=a.index+_(a.parsedRoot,a.memberIndex,c),t=this._mergeRowData(t,i,h,f)),{axes:d,data:t}},_mergeColumnData:function(e,t,n,i,o){var r,a,s,l=this.data().toJSON(),c=0,d=Math.max(this._columnMeasures().length,1);for(n=Math.max(n,1),l.length>0&&(c=d,o-=d),r=0;n>r;r++)a=t+r*o,s=e.splice(0,i),s.splice(0,c),[].splice.apply(l,[a,0].concat(s));return l},_mergeRowData:function(e,t,n,i){var o,r,a,s=this.data().toJSON(),l=Math.max(this._rowMeasures().length,1);for(i=Math.max(i,1),s.length>0&&(n-=l,e.splice(0,i*l)),o=0;n>o;o++)a=e.splice(0,i),r=t*i+o*i,[].splice.apply(s,[r,0].concat(a));return s},_columnMeasures:function(){var e=this.measures(),t=[];return"columns"===this.measuresAxis()&&(0===this.columns().length?t=e:e.length>1&&(t=e)),t},_rowMeasures:function(){var e=this.measures(),t=[];return"rows"===this.measuresAxis()&&(0===this.rows().length?t=e:e.length>1&&(t=e)),t},_updateLocalData:function(e,t){this.cubeBuilder&&(t&&(this._requestData=t),e=this._processResult(e)),this._data=this._observe(e),this._ranges=[],this._addRange(this._data),this._total=this._data.length,this._pristineTotal=this._total,this._process(this._data)},data:function(e){var n=this;return e===t?n._data:(this._pristineData=e.slice(0),this._updateLocalData(e,{columns:this.columns(),rows:this.rows(),measures:this.measures()}),t)},_normalizeTuples:function(e,t,n,i){var o,r,a,s=i.length||1,l=0,c=[],d={},h=0;if(e.length){if(0>=this._skipNormalize&&!this._hasRoot(e[0],t,n)){for(this._skipNormalize=0;s>l;l++)c.push(this._createTuple(e[0],i[l],!0)),d[l]=l;e.splice.apply(e,[0,e.length].concat(c).concat(e)),l=s}if(i.length)for(a=o=e[l],r=o.members.length-1;o;){if(h>=s&&(h=0),o.members[r].name!==i[h].name&&(e.splice(l,0,this._createTuple(o,i[h])),d[l]=l),l+=1,h+=1,o=e[l],s>h&&(!o||st(a,r-1)!==st(o,r-1))){for(;s>h;h++)e.splice(l,0,this._createTuple(a,i[h])),d[l]=l,l+=1;o=e[l]}a=o}return d}},_normalizeData:function(e){var n,i,o=e.data,r=e.columnIndexes||{},a=e.rowIndexes||{},s=e.columnsLength||1,l=s*(e.rowsLength||1),c=0,d=0,h=0,u=Array(l);if(o.length===l)return o;for(;l>c;c++){for(;a[parseInt(c/s,10)]!==t;)for(i=0;s>i;i++)u[c]={value:"",fmtValue:"",ordinal:c},c+=1;for(;r[c%s]!==t;)u[c]={value:"",fmtValue:"",ordinal:c},c+=1;if(n=o[d]){if(n.ordinal-h>1)for(h+=1;n.ordinal>h;h++)u[c]={value:"",fmtValue:"",ordinal:c},c+=1;h=n.ordinal,n.ordinal=c,u[c]=n,d+=1}else u[c]={value:"",fmtValue:"",ordinal:c}}return u},discover:function(t,n){var i=this,o=i.transport;return e.Deferred(function(e){o.discover(yt({success:function(t){t=i.reader.parse(t),i._handleCustomErrors(t)||(n&&(t=n(t)),e.resolve(t))},error:function(t,n,o){e.reject(t),i.error(t,n,o)}},t))}).promise().done(function(){i.trigger("schemaChange")})},schemaMeasures:function(){var e=this;return e.discover({data:{command:"schemaMeasures",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},function(t){return e.reader.measures(t)})},schemaKPIs:function(){var e=this;return e.discover({data:{command:"schemaKPIs",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},function(t){return e.reader.kpis(t)})},schemaDimensions:function(){var e=this;return e.discover({data:{command:"schemaDimensions",restrictions:{catalogName:e.transport.catalog(),cubeName:e.transport.cube()}}},function(t){return e.reader.dimensions(t)})},schemaHierarchies:function(e){var t=this;return t.discover({data:{command:"schemaHierarchies",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),dimensionUniqueName:e}}},function(e){return t.reader.hierarchies(e)})},schemaLevels:function(e){var t=this;return t.discover({data:{command:"schemaLevels",restrictions:{catalogName:t.transport.catalog(),cubeName:t.transport.cube(),hierarchyUniqueName:e}}},function(e){return t.reader.levels(e)})},schemaCubes:function(){var e=this;return e.discover({data:{command:"schemaCubes",restrictions:{catalogName:e.transport.catalog()}}},function(t){return e.reader.cubes(t)})},schemaCatalogs:function(){var e=this;return e.discover({data:{command:"schemaCatalogs"}},function(t){return e.reader.catalogs(t)})},schemaMembers:function(e){var t=this;return t.discover({data:{command:"schemaMembers",restrictions:yt({catalogName:t.transport.catalog(),cubeName:t.transport.cube()},e)}},function(e){return t.reader.members(e)})},_params:function(e){this._clearAxesData&&(this._axes={},this._data=this._observe([]),this._clearAxesData=!1,this.trigger(Tt));var t=mt.fn._params.call(this,e);return t=yt({measures:this.measures(),measuresAxis:this.measuresAxis(),columns:this.columns(),rows:this.rows()},t),this.cubeBuilder&&(this._requestData=t),t}});Gt.create=function(e){e=e&&e.push?{data:e}:e;var t=e||{},n=t.data;if(t.data=n,!(t instanceof Gt)&&t instanceof ut.data.DataSource)throw Error("Incorrect DataSource type. Only PivotDataSource instances are supported");return t instanceof Gt?t:new Gt(t)},q={contains:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}") > 0',doesnotcontain:', InStr({0}.CurrentMember.MEMBER_CAPTION,"{1}") = 0',startswith:', Left({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',endswith:', Right({0}.CurrentMember.MEMBER_CAPTION,Len("{1}"))="{1}"',eq:', {0}.CurrentMember.MEMBER_CAPTION = "{1}"',neq:', NOT {0}.CurrentMember.MEMBER_CAPTION = "{1}"'},$={schemaCubes:"MDSCHEMA_CUBES",schemaCatalogs:"DBSCHEMA_CATALOGS",schemaMeasures:"MDSCHEMA_MEASURES",schemaDimensions:"MDSCHEMA_DIMENSIONS",schemaHierarchies:"MDSCHEMA_HIERARCHIES",schemaLevels:"MDSCHEMA_LEVELS",schemaMembers:"MDSCHEMA_MEMBERS",schemaKPIs:"MDSCHEMA_KPIS"},Y={read:function(e){var t,n,i,o,r,a='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Execute xmlns="urn:schemas-microsoft-com:xml-analysis"><Command><Statement>';return a+="SELECT NON EMPTY {",t=e.columns||[],n=e.rows||[],i=e.measures||[],o="rows"===e.measuresAxis,r=e.sort||[],!t.length&&n.length&&(!i.length||i.length&&o)&&(t=n,n=[],o=!1),t.length||n.length||(o=!1),t.length?a+=H(t,o?[]:i,r):i.length&&!o&&(a+=L(i).join(",")),a+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON COLUMNS",(n.length||o&&i.length>1)&&(a+=", NON EMPTY {",a+=n.length?H(n,o?i:[],r):L(i).join(","),a+="} DIMENSION PROPERTIES CHILDREN_CARDINALITY, PARENT_UNIQUE_NAME ON ROWS"),e.filter?(a+=" FROM ",a+="(",a+=U(e.filter,e.connection.cube),a+=")"):a+=" FROM ["+e.connection.cube+"]",1==i.length&&t.length&&(a+=" WHERE ("+L(i).join(",")+")"),a+="</Statement></Command><Properties><PropertyList><Catalog>"+e.connection.catalog+"</Catalog><Format>Multidimensional</Format></PropertyList></Properties></Execute></Body></Envelope>",a.replace(/\&/g,"&amp;")},discover:function(t){t=t||{};var n='<Envelope xmlns="http://schemas.xmlsoap.org/soap/envelope/"><Header/><Body><Discover xmlns="urn:schemas-microsoft-com:xml-analysis">';return n+="<RequestType>"+($[t.command]||t.command)+"</RequestType>",n+="<Restrictions>"+W("RestrictionList",t.restrictions,!0)+"</Restrictions>",t.connection&&t.connection.catalog&&(t.properties=e.extend({},{Catalog:t.connection.catalog},t.properties)),n+="<Properties>"+W("PropertyList",t.properties)+"</Properties>",n+="</Discover></Body></Envelope>"}},Q=ut.data.RemoteTransport.extend({init:function(e){var t=e;e=this.options=yt(!0,{},this.options,e),ut.data.RemoteTransport.call(this,e),bt(t.discover)?this.discover=t.discover:"string"==typeof t.discover?this.options.discover={url:t.discover}:t.discover||(this.options.discover=this.options.read)},setup:function(t,n){return t.data=t.data||{},e.extend(!0,t.data,{connection:this.options.connection}),ut.data.RemoteTransport.fn.setup.call(this,t,n)},options:{read:{dataType:"text",contentType:"text/xml",type:"POST"},discover:{dataType:"text",contentType:"text/xml",type:"POST"},parameterMap:function(e,t){return Y[t](e,t)}},discover:function(t){return e.ajax(this.setup(t,"discover"))}}),X={cubes:{name:ut.getter("CUBE_NAME['#text']",!0),caption:ut.getter("CUBE_CAPTION['#text']",!0),description:ut.getter("DESCRIPTION['#text']",!0),type:ut.getter("CUBE_TYPE['#text']",!0)},catalogs:{name:ut.getter("CATALOG_NAME['#text']",!0),description:ut.getter("DESCRIPTION['#text']",!0)},measures:{name:ut.getter("MEASURE_NAME['#text']",!0),caption:ut.getter("MEASURE_CAPTION['#text']",!0),uniqueName:ut.getter("MEASURE_UNIQUE_NAME['#text']",!0),description:ut.getter("DESCRIPTION['#text']",!0),aggregator:ut.getter("MEASURE_AGGREGATOR['#text']",!0),groupName:ut.getter("MEASUREGROUP_NAME['#text']",!0),displayFolder:ut.getter("MEASURE_DISPLAY_FOLDER['#text']",!0),defaultFormat:ut.getter("DEFAULT_FORMAT_STRING['#text']",!0)},kpis:{name:ut.getter("KPI_NAME['#text']",!0),caption:ut.getter("KPI_CAPTION['#text']",!0),value:ut.getter("KPI_VALUE['#text']",!0),goal:ut.getter("KPI_GOAL['#text']",!0),status:ut.getter("KPI_STATUS['#text']",!0),trend:ut.getter("KPI_TREND['#text']",!0),statusGraphic:ut.getter("KPI_STATUS_GRAPHIC['#text']",!0),trendGraphic:ut.getter("KPI_TREND_GRAPHIC['#text']",!0),description:ut.getter("KPI_DESCRIPTION['#text']",!0),groupName:ut.getter("MEASUREGROUP_NAME['#text']",!0)},dimensions:{name:ut.getter("DIMENSION_NAME['#text']",!0),caption:ut.getter("DIMENSION_CAPTION['#text']",!0),description:ut.getter("DESCRIPTION['#text']",!0),uniqueName:ut.getter("DIMENSION_UNIQUE_NAME['#text']",!0),defaultHierarchy:ut.getter("DEFAULT_HIERARCHY['#text']",!0),type:ut.getter("DIMENSION_TYPE['#text']",!0)},hierarchies:{name:ut.getter("HIERARCHY_NAME['#text']",!0),caption:ut.getter("HIERARCHY_CAPTION['#text']",!0),description:ut.getter("DESCRIPTION['#text']",!0),uniqueName:ut.getter("HIERARCHY_UNIQUE_NAME['#text']",!0),dimensionUniqueName:ut.getter("DIMENSION_UNIQUE_NAME['#text']",!0),displayFolder:ut.getter("HIERARCHY_DISPLAY_FOLDER['#text']",!0),origin:ut.getter("HIERARCHY_ORIGIN['#text']",!0),defaultMember:ut.getter("DEFAULT_MEMBER['#text']",!0)},levels:{name:ut.getter("LEVEL_NAME['#text']",!0),caption:ut.getter("LEVEL_CAPTION['#text']",!0),description:ut.getter("DESCRIPTION['#text']",!0),uniqueName:ut.getter("LEVEL_UNIQUE_NAME['#text']",!0),dimensionUniqueName:ut.getter("DIMENSION_UNIQUE_NAME['#text']",!0),displayFolder:ut.getter("LEVEL_DISPLAY_FOLDER['#text']",!0),orderingProperty:ut.getter("LEVEL_ORDERING_PROPERTY['#text']",!0),origin:ut.getter("LEVEL_ORIGIN['#text']",!0),hierarchyUniqueName:ut.getter("HIERARCHY_UNIQUE_NAME['#text']",!0)},members:{name:ut.getter("MEMBER_NAME['#text']",!0),caption:ut.getter("MEMBER_CAPTION['#text']",!0),uniqueName:ut.getter("MEMBER_UNIQUE_NAME['#text']",!0),dimensionUniqueName:ut.getter("DIMENSION_UNIQUE_NAME['#text']",!0),hierarchyUniqueName:ut.getter("HIERARCHY_UNIQUE_NAME['#text']",!0),levelUniqueName:ut.getter("LEVEL_UNIQUE_NAME['#text']",!0),childrenCardinality:ut.getter("CHILDREN_CARDINALITY['#text']",!0)}},K=["axes","catalogs","cubes","dimensions","hierarchies","levels","measures"],Z=ut.data.XmlDataReader.extend({init:function(e){ut.data.XmlDataReader.call(this,e),this._extend(e)
},_extend:function(e){for(var t,n,i=0,o=K.length;o>i;i++)t=K[i],n=e[t],n&&n!==_t&&(this[t]=n)},parse:function(e){var t=ut.data.XmlDataReader.fn.parse(e.replace(/<(\/?)(\w|-)+:/g,"<$1"));return ut.getter("['Envelope']['Body']",!0)(t)},errors:function(e){var t=ut.getter("['Fault']",!0)(e);return t?[{faultstring:ut.getter("faultstring['#text']",!0)(t),faultcode:ut.getter("faultcode['#text']",!0)(t)}]:null},axes:function(e){var t,n,i,o;for(e=ut.getter('ExecuteResponse["return"].root',!0)(e),t=j(ut.getter("Axes.Axis",!0)(e)),i={columns:{},rows:{}},o=0;t.length>o;o++)n=t[o],"sliceraxis"!==n["@name"].toLowerCase()&&(i.columns.tuples?i.rows=G(n):i.columns=G(n));return i},data:function(e){var t,n,i,o,r,a;for(e=ut.getter('ExecuteResponse["return"].root',!0)(e),t=j(ut.getter("CellData.Cell",!0)(e)),n=[],i=ut.getter("['@CellOrdinal']"),o=ut.getter("Value['#text']"),r=ut.getter("FmtValue['#text']"),a=0;t.length>a;a++)n.push({value:o(t[a]),fmtValue:r(t[a]),ordinal:parseInt(i(t[a]),10)});return n},_mapSchema:function(e,t){var n,i,o,r,a;for(e=ut.getter('DiscoverResponse["return"].root',!0)(e),n=j(ut.getter("row",!0)(e)),i=[],o=0;n.length>o;o++){r={};for(a in t)r[a]=t[a](n[o]);i.push(r)}return i},measures:function(e){return this._mapSchema(e,X.measures)},kpis:function(e){return this._mapSchema(e,X.kpis)},hierarchies:function(e){return this._mapSchema(e,X.hierarchies)},levels:function(e){return this._mapSchema(e,X.levels)},dimensions:function(e){return this._mapSchema(e,X.dimensions)},cubes:function(e){return this._mapSchema(e,X.cubes)},catalogs:function(e){return this._mapSchema(e,X.catalogs)},members:function(e){return this._mapSchema(e,X.members)}}),yt(!0,ut.data,{PivotDataSource:Gt,XmlaTransport:Q,XmlaDataReader:Z,PivotCubeBuilder:Wt,transports:{xmla:Q},readers:{xmla:Z}}),J=function(e,t){if(!e)return null;for(var n=0,i=e.length;i>n;n++)if(e[n].field===t)return e[n];return null},et=function(e,t){var n,i,o=[];for(n=0,i=e.length;i>n;n++)e[n].field!==t&&o.push(e[n]);return o},ut.ui.PivotSettingTarget=gt.extend({init:function(t,n){var i=this;gt.fn.init.call(i,t,n),i.element.addClass("k-pivot-setting"),i.dataSource=ut.data.PivotDataSource.create(n.dataSource),i._refreshHandler=e.proxy(i.refresh,i),i.dataSource.first(xt,i._refreshHandler),n.template||(i.options.template="<div data-"+ut.ns+'name="${data.name || data}">${data.name || data}'+(i.options.enabled?'<a class="k-button k-button-icon k-button-bare"><span class="k-icon k-setting-delete"></span></a>':"")+"</div>"),i.template=ut.template(i.options.template),i.emptyTemplate=ut.template(i.options.emptyTemplate),i._sortable(),i.element.on("click"+Pt,".k-button,.k-item",function(t){var n=e(t.target),o=n.closest("["+ut.attr("name")+"]").attr(ut.attr("name"));o&&(n.hasClass("k-setting-delete")?i.remove(o):i.options.sortable&&n[0]===t.currentTarget&&i.sort({field:o,dir:n.find(".k-i-sort-asc")[0]?"desc":"asc"}))}),(n.filterable||n.sortable)&&(i.fieldMenu=new ft.PivotFieldMenu(i.element,{messages:i.options.messages.fieldMenu,filter:".k-setting-fieldmenu",filterable:n.filterable,sortable:n.sortable,dataSource:i.dataSource})),i.refresh()},options:{name:"PivotSettingTarget",template:null,filterable:!1,sortable:!1,emptyTemplate:"<div class='k-empty'>${data}</div>",setting:"columns",enabled:!0,messages:{empty:"Drop Fields Here"}},setDataSource:function(e){this.dataSource.unbind(xt,this._refreshHandler),this.dataSource=this.options.dataSource=e,this.fieldMenu&&this.fieldMenu.setDataSource(e),e.first(xt,this._refreshHandler),this.refresh()},_sortable:function(){var e=this;e.options.enabled&&(this.sortable=this.element.kendoSortable({connectWith:this.options.connectWith,filter:">:not(.k-empty)",hint:e.options.hint,cursor:"move",start:function(e){e.item.focus().blur()},change:function(t){var n=t.item.attr(ut.attr("name"));"receive"==t.action?e.add(n):"remove"==t.action?e.remove(n):"sort"==t.action&&e.move(n,t.newIndex)}}).data("kendoSortable"))},_indexOf:function(e,t){var n,i,o=-1;for(n=0,i=t.length;i>n;n++)if(F(t[n])===e){o=n;break}return o},_isKPI:function(e){return"kpi"===e.type||e.measure},validate:function(e){var t,n,i=2==e.type||"aggregator"in e||this._isKPI(e);return i?"measures"===this.options.setting:"measures"===this.options.setting?i:(t=this.dataSource[this.options.setting](),n=e.defaultHierarchy||e.uniqueName,this._indexOf(n,t)>-1?!1:(t=this.dataSource["columns"===this.options.setting?"rows":"columns"](),this._indexOf(n,t)>-1?!1:!0))},add:function(t){var n,i,o=this.dataSource[this.options.setting]();for(t=e.isArray(t)?t.slice(0):[t],n=0,i=t.length;i>n;n++)-1!==this._indexOf(t[n],o)&&(t.splice(n,1),n-=1,i-=1);t.length&&(o=o.concat(t),this.dataSource[this.options.setting](o))},move:function(e,t){var n=this.dataSource[this.options.setting](),i=this._indexOf(e,n);i>-1&&(e=n.splice(i,1)[0],n.splice(t,0,e),this.dataSource[this.options.setting](n))},remove:function(e){var t=this.dataSource[this.options.setting](),n=this._indexOf(e,t);n>-1&&(t.splice(n,1),this.dataSource[this.options.setting](t))},sort:function(e){var t=this.options.sortable,n=t===!0||t.allowUnsort,i=n&&"asc"===e.dir,o=this.dataSource.sort()||[],r=et(o,e.field);i&&o.length!==r.length&&(e=null),e&&r.push(e),this.dataSource.sort(r)},refresh:function(){var e,n="",i=this.dataSource[this.options.setting](),o=i.length,r=0;if(o)for(;o>r;r++)e=i[r],e=e.name===t?{name:e}:e,n+=this.template(yt({sortIcon:this._sortIcon(e.name)},e));else n=this.emptyTemplate(this.options.messages.empty);this.element.html(n)},destroy:function(){gt.fn.destroy.call(this),this.dataSource.unbind(xt,this._refreshHandler),this.element.off(Pt),this.sortable&&this.sortable.destroy(),this.fieldMenu&&this.fieldMenu.destroy(),this.element=null,this._refreshHandler=null},_sortIcon:function(e){var t=this.dataSource.sort(),n=J(t,F(e)),i="";return n&&(i="k-i-sort-"+n.dir),i}}),tt=gt.extend({init:function(n,i){var o,r,a=this;gt.fn.init.call(a,n,i),a._dataSource(),a._bindConfigurator(),a._wrapper(),a._createLayout(),a._columnBuilder=o=new lt,a._rowBuilder=r=new ct,a._contentBuilder=new dt,a._templates(),a.columnsHeader.add(a.rowsHeader).on("click","span.k-icon",function(){var n,i,s,l,c=e(this),d=o,h="expandColumn",u=c.attr(ut.attr("path")),f={axis:"columns",path:e.parseJSON(u)};c.parent().is("td")&&(d=r,h="expandRow",f.axis="rows"),i=c.hasClass(Lt),s=d.metadata[u],l=s.expanded===t,n=i?zt:Bt,a.trigger(n,f)||(d.metadata[u].expanded=!i,c.toggleClass(Lt,!i).toggleClass(Ft,i),!i&&l?a.dataSource[h](f.path):a.refresh())}),a._scrollable(),a.options.autoBind&&a.dataSource.fetch(),ut.notify(a)},events:[Mt,It,Bt,zt],options:{name:"PivotGrid",autoBind:!0,reorderable:!0,filterable:!1,sortable:!1,height:null,columnWidth:100,configurator:"",columnHeaderTemplate:null,rowHeaderTemplate:null,dataCellTemplate:null,kpiStatusTemplate:null,kpiTrendTemplate:null,messages:{measureFields:"Drop Data Fields Here",columnFields:"Drop Column Fields Here",rowFields:"Drop Rows Fields Here"}},_templates:function(){var e=this.options.columnHeaderTemplate,t=this.options.rowHeaderTemplate,n=this.options.dataCellTemplate,i=this.options.kpiStatusTemplate,o=this.options.kpiTrendTemplate;this._columnBuilder.template=ut.template(e||Rt,{useWithBlock:!!e}),this._contentBuilder.dataTemplate=ut.template(n||Ht,{useWithBlock:!!n}),this._contentBuilder.kpiStatusTemplate=ut.template(i||Ot,{useWithBlock:!!i}),this._contentBuilder.kpiTrendTemplate=ut.template(o||Nt,{useWithBlock:!!o}),this._rowBuilder.template=ut.template(t||Rt,{useWithBlock:!!t})},_bindConfigurator:function(){var t=this.options.configurator;t&&e(t).kendoPivotConfigurator("setDataSource",this.dataSource)},cellInfoByElement:function(t){return t=e(t),this.cellInfo(t.index(),t.parent("tr").index())},cellInfo:function(e,t){var n,i=this._contentBuilder,o=i.columnIndexes[e||0],r=i.rowIndexes[t||0];return o&&r?(n=r.index*i.rowLength+o.index,{columnTuple:o.tuple,rowTuple:r.tuple,measure:o.measure||r.measure,dataItem:this.dataSource.view()[n]}):null},setDataSource:function(e){this.options.dataSource=e,this._dataSource(),this.measuresTarget&&this.measuresTarget.setDataSource(e),this.rowsTarget&&this.rowsTarget.setDataSource(e),this.columnsTarget&&this.columnsTarget.setDataSource(e),this._bindConfigurator(),this.options.autoBind&&e.fetch()},setOptions:function(e){gt.fn.setOptions.call(this,e),this._templates()},_dataSource:function(){var t=this,n=t.options.dataSource;n=e.isArray(n)?{data:n}:n,t.dataSource&&this._refreshHandler?t.dataSource.unbind(xt,t._refreshHandler).unbind(Tt,t._stateResetHandler).unbind(St,t._progressHandler).unbind(kt,t._errorHandler):(t._refreshHandler=e.proxy(t.refresh,t),t._progressHandler=e.proxy(t._requestStart,t),t._stateResetHandler=e.proxy(t._stateReset,t),t._errorHandler=e.proxy(t._error,t)),t.dataSource=ut.data.PivotDataSource.create(n).bind(xt,t._refreshHandler).bind(St,t._progressHandler).bind(Tt,t._stateResetHandler).bind(kt,t._errorHandler)},_error:function(){this._progress(!1)},_requestStart:function(){this._progress(!0)},_stateReset:function(){this._columnBuilder.reset(),this._rowBuilder.reset()},_wrapper:function(){var e=this.options.height;this.wrapper=this.element.addClass("k-widget k-pivot"),e&&this.wrapper.css("height",e)},_measureFields:function(){this.measureFields=e(At).addClass("k-pivot-toolbar k-header k-settings-measures"),this.measuresTarget=this._createSettingTarget(this.measureFields,{setting:"measures",messages:{empty:this.options.messages.measureFields}})},_createSettingTarget:function(t,n){var i='<span tabindex="0" class="k-button" data-'+ut.ns+'name="${data.name}">${data.name}',o=n.sortable,r="";return o&&(r+="#if (data.sortIcon) {#",r+='<span class="k-icon ${data.sortIcon} k-setting-sort"></span>',r+="#}#"),(n.filterable||o)&&(r+='<span class="k-icon k-i-arrowhead-s k-setting-fieldmenu"></span>'),this.options.reorderable&&(r+='<span class="k-icon k-si-close k-setting-delete"></span>'),r&&(i+='<span class="k-field-actions">'+r+"</span>"),i+="</span>",new ut.ui.PivotSettingTarget(t,e.extend({template:i,emptyTemplate:'<span class="k-empty">${data}</span>',enabled:this.options.reorderable,dataSource:this.dataSource},n))},_initSettingTargets:function(){this.columnsTarget=this._createSettingTarget(this.columnFields,{connectWith:this.rowFields,setting:"columns",filterable:this.options.filterable,sortable:this.options.sortable,messages:{empty:this.options.messages.columnFields,fieldMenu:this.options.messages.fieldMenu}}),this.rowsTarget=this._createSettingTarget(this.rowFields,{connectWith:this.columnFields,setting:"rows",filterable:this.options.filterable,sortable:this.options.sortable,messages:{empty:this.options.messages.rowFields,fieldMenu:this.options.messages.fieldMenu}})},_createLayout:function(){var t=this,n=e(Vt),i=n.find(".k-pivot-rowheaders"),o=n.find(".k-pivot-table"),r=e(At).addClass("k-grid k-widget");t._measureFields(),t.columnFields=e(At).addClass("k-pivot-toolbar k-header k-settings-columns"),t.rowFields=e(At).addClass("k-pivot-toolbar k-header k-settings-rows"),t.columnsHeader=e('<div class="k-grid-header-wrap" />').wrap('<div class="k-grid-header" />'),t.columnsHeader.parent().css("padding-right",ut.support.scrollbar()),t.rowsHeader=e('<div class="k-grid k-widget k-alt"/>'),t.content=e('<div class="k-grid-content" />'),i.append(t.measureFields),i.append(t.rowFields),i.append(t.rowsHeader),r.append(t.columnsHeader.parent()),r.append(t.content),o.append(t.columnFields),o.append(r),t.wrapper.append(n),t.columnsHeaderTree=new ut.dom.Tree(t.columnsHeader[0]),t.rowsHeaderTree=new ut.dom.Tree(t.rowsHeader[0]),t.contentTree=new ut.dom.Tree(t.content[0]),t._initSettingTargets()},_progress:function(e){ut.ui.progress(this.wrapper,e)},_resize:function(){this.columnsHeader.children("table"),this.content.children("table");this.content[0].firstChild&&(this._setSectionsWidth(),this._setSectionsHeight(),this._setContentWidth(),this._setContentHeight())},_setSectionsWidth:function(){var e=this.rowsHeader,t=e.parent(".k-pivot-rowheaders").width(Dt),n=Math.max(this.measureFields.outerWidth(),this.rowFields.outerWidth());n=Math.max(e.children("table").width(),n),t.width(n)},_setSectionsHeight:function(){var e=this.measureFields.height(Dt).height(),t=this.columnFields.height(Dt).height(),n=this.rowFields.height(Dt).innerHeight(),i=this.columnsHeader.height(Dt).innerHeight(),o=n-this.rowFields.height(),r=t>e?t:e,a=i>n?i:n;this.measureFields.height(r),this.columnFields.height(r),this.rowFields.height(a-o),this.columnsHeader.height(a)},_setContentWidth:function(){var e=this.content.find("table"),t=this.columnsHeader.children("table"),n=e.children("colgroup").children().length,i=n*this.options.columnWidth,o=Math.ceil(i/this.content.width()*100);100>o&&(o=100),e.add(t).css("width",o+"%"),this._resetColspan(t)},_setContentHeight:function(){var e=this,n=e.content,i=e.rowsHeader,o=e.wrapper.innerHeight(),r=ut.support.scrollbar(),a=n[0].offsetHeight===n[0].clientHeight,s=e.options.height;if(e.wrapper.is(":visible")){if(!o||!s)return a&&(r=0),n.height("auto"),i.height(n.height()-r),t;o-=e.columnFields.outerHeight(),o-=e.columnsHeader.outerHeight(),2*r>=o&&(o=2*r+1,a||(o+=r)),n.height(o),a&&(r=0),i.height(o-r)}},_resetColspan:function(e){var n=this,i=e.children("tbody").children(":first").children(":first");n._colspan===t&&(n._colspan=i.attr("colspan")),i.attr("colspan",1),clearTimeout(n._layoutTimeout),n._layoutTimeout=setTimeout(function(){i.attr("colspan",n._colspan),n._colspan=t})},_axisMeasures:function(e){var t=[],n=this.dataSource,i=n.measures(),o=i.length>1||i[0]&&i[0].type;return n.measuresAxis()===e&&(0===n[e]().length||o)&&(t=i),t},items:function(){return[]},refresh:function(){var e,t=this,n=t.dataSource,i=n.axes(),o=(i.columns||{}).tuples||[],r=(i.rows||{}).tuples||[],a=t._columnBuilder,s=t._rowBuilder,l={},c={};t.trigger(Mt,{action:"rebind"})||(a.measures=t._axisMeasures("columns"),t.columnsHeaderTree.render(a.build(o)),t.rowsHeaderTree.render(s.build(r)),l={indexes:a._indexes,measures:a.measures,metadata:a.metadata},c={indexes:s._indexes,measures:this._axisMeasures("rows"),metadata:s.metadata},t.contentTree.render(t._contentBuilder.build(n.view(),l,c)),t._resize(),t.touchScroller?t.touchScroller.contentResized():(e=ut.touchScroller(t.content),e&&e.movable&&(t.touchScroller=e,e.movable.bind("change",function(e){t.columnsHeader.scrollLeft(-e.sender.x),t.rowsHeader.scrollTop(-e.sender.y)}))),t._progress(!1),t.trigger(It))},_scrollable:function(){var t=this,n=t.columnsHeader,i=t.rowsHeader;t.content.scroll(function(){n.scrollLeft(this.scrollLeft),i.scrollTop(this.scrollTop)}),i.bind("DOMMouseScroll"+Pt+" mousewheel"+Pt,e.proxy(t._wheelScroll,t))},_wheelScroll:function(t){var n,i;t.ctrlKey||(n=ut.wheelDeltaY(t),i=this.content.scrollTop(),n&&(t.preventDefault(),e(t.currentTarget).one("wheel"+Pt,!1),this.rowsHeader.scrollTop(i+-n),this.content.scrollTop(i+-n)))}}),nt=ut.dom.element,it=ut.dom.html,ot=ut.dom.text,rt=function(e,t){return{maxChildren:0,children:0,maxMembers:0,members:0,measures:1,levelNum:e,parentMember:0!==t}},at=function(e,t){for(var n=[],i=0;t>=i;i++)n.push(e.members[i].name);return n},st=function(e,t){for(var n="",i=0;t>=i;i++)n+=e.members[i].name;return n},lt=pt.extend({init:function(){this.measures=1,this.metadata={}},build:function(e){var t=this._tbody(e),n=this._colGroup();return[nt("table",null,[n,t])]},reset:function(){this.metadata={}},_colGroup:function(){for(var e=this._rowLength(),t=[],n=0;e>n;n++)t.push(nt("col",null));return nt("colgroup",null,t)},_tbody:function(e){var t=e[0];return this.map={},this.rows=[],this.rootTuple=t,this._indexes=[],t?(this._buildRows(t,0),this._normalize()):this.rows.push(nt("tr",null,[nt("th",null,[it("&nbsp;")])])),nt("tbody",null,this.rows)},_normalize:function(){for(var e,t,n,i,o,r=this.rows,a=r.length,s=0;a>s;s++)if(e=r[s],1!==e.rowSpan)for(i=e.children,n=0,t=i.length;t>n;n++)o=i[n],o.tupleAll&&(o.attr.rowSpan=e.rowSpan)},_rowIndex:function(e){for(var t=this.rows,n=t.length,i=0;n>i&&t[i]!==e;i++);return i},_rowLength:function(){var e=this.rows[0]?this.rows[0].children:[],t=e.length,n=0,i=0;if(t)for(;t>i;i++)n+=e[i].attr.colSpan||1;return n||(n=this.measures),n},_row:function(e,t,n){var i,o,r=this.rootTuple.members[t].name,a=e.members[t].levelNum,s=r+a,l=this.map,c=l[s];return c?(c.notFirst=!1,c.parentMember&&c.parentMember===n||(c.parentMember=n,c.collapsed=0,c.colSpan=0)):(c=nt("tr",null,[]),c.parentMember=n,c.collapsed=0,c.colSpan=0,c.rowSpan=1,l[s]=c,i=l[r+(+a-1)],i&&(o=i.children,c.notFirst=o[1]&&-1===o[1].attr.className.indexOf("k-alt")?!0:i.notFirst),this.rows.splice(this._rowIndex(i)+1,0,c)),c},_measures:function(e,t,n){var i,o,r,a=this.map,s=a.measureRow;for(s||(s=nt("tr",null,[]),a.measureRow=s,this.rows.push(s)),o=0,r=e.length;r>o;o++)i=e[o],s.children.push(this._cell(n||"",[this._content(i,t)],i));return r},_content:function(e,t){return it(this.template({member:e,tuple:t}))},_cell:function(e,t,n){var i=nt("th",{className:"k-header"+e},t);return i.value=n.caption||n.name,i},_buildRows:function(e,n,i){var o,r,a,s,l,c,d,h,u,f,p=e.members,g=p[n],m=p[n+1],v=[],_=0,w=0,y=0;if(g.measure)return this._measures(g.children,e),t;if(h=ut.stringify(at(e,n)),o=this._row(e,n,i),a=g.children,s=a.length,u=this.metadata[h],u||(this.metadata[h]=u=rt(+g.levelNum,n)),this._indexes.push({path:h,tuple:e}),g.hasChildren&&(u.expanded===!1&&(w=u.maxChildren,o.collapsed+=w,u.children=0,s=0),d={className:"k-icon "+(s?Lt:Ft)},d[ut.attr("path")]=h,v.push(nt("span",d))),v.push(this._content(g,e)),l=this._cell(o.notFirst?" k-first":"",v,g),o.children.push(l),o.colSpan+=1,s){for(c=this._cell(" k-alt",[this._content(g,e)],g),o.children.push(c);s>_;_++)r=this._buildRows(a[_],n,g);f=r.colSpan,w=r.collapsed,l.attr.colSpan=f,u.children=f,u.members=1,o.colSpan+=f,o.collapsed+=w,o.rowSpan=r.rowSpan+1,m&&(m.measure?f=this._measures(m.children,e," k-alt"):(r=this._buildRows(e,n+1),f=r.colSpan,o.collapsed+=r.collapsed,y=r.collapsed),c.attr.colSpan=f,f-=1,u.members+=f,o.colSpan+=f)}else m&&(m.measure?f=this._measures(m.children,e):(r=this._buildRows(e,n+1),f=r.colSpan,o.collapsed+=r.collapsed,y=r.collapsed),u.members=f,f>1&&(l.attr.colSpan=f,o.colSpan+=f-1));return u.members+y>u.maxMembers&&(u.maxMembers=u.members+y),a=u.children+w,a>u.maxChildren&&(u.maxChildren=a),(c||l).tupleAll=!0,o}}),ct=pt.extend({init:function(){this.metadata={}},build:function(e){var t=this._tbody(e),n=this._colGroup();return[nt("table",null,[n,t])]},reset:function(){this.metadata={}},_rowLength:function(){for(var e=this.rows[0].children,t=0,n=0,i=e[n];i;)t+=i.attr.colSpan||1,i=e[++n];return t},_colGroup:function(){for(var e=this._rowLength(),t=[],n=0;e>n;n++)t.push(nt("col",null));return nt("colgroup",null,t)},_tbody:function(e){var t=e[0];return this.rootTuple=t,this.rows=[],this.map={},this._indexes=[],t?(this._buildRows(t,0),this._normalize()):this.rows.push(nt("tr",null,[nt("td",null,[it("&nbsp;")])])),nt("tbody",null,this.rows)},_normalize:function(){for(var e,t,n,i,o=this.rows,r=o.length,a=0,s=this.rootTuple.members,l=s[0].name,c=s.length,d=0,h=this.map;r>a;a++)for(e=o[a],d=0;c>d;d++)n=this[s[d].name],t=e.colSpan["dim"+d],t&&n>t.levelNum&&(t.attr.colSpan=n-t.levelNum+1);e=h[l],i=h[l+"all"],e&&(e.children[0].attr.className="k-first"),i&&(i.children[0].attr.className+=" k-first")},_row:function(e){var t=nt("tr",null,e);return t.rowSpan=1,t.colSpan={},this.rows.push(t),t},_content:function(e,t){return it(this.template({member:e,tuple:t}))},_cell:function(e,t,n){var i=nt("td",{className:e},t);return i.value=n.caption||n.name,i},_buildRows:function(e,t){var n,i,o,r,a,s,l,c,d,h=this.map,u=e.members,f=u[t],p=u[t+1],g=f.children,m=g.length,v=+f.levelNum+1,_=this.rootTuple.members[t].name,w=at(e,t-1).join(""),y=w+(f.parentName||""),b=h[y+"all"]||h[y],x=[];if(!b||b.hasChild?b=this._row():b.hasChild=!0,f.measure){for(a=b.allCell?"k-grid-footer":"",b.children.push(this._cell(a,[this._content(g[0],e)],g[0])),b.rowSpan=m,d=1;m>d;d++)this._row([this._cell(a,[this._content(g[d],e)],g[d])]);return b}if(h[w+f.name]=b,n=ut.stringify(at(e,t)),r=this.metadata[n],r||(this.metadata[n]=r=rt(v-1,t)),this._indexes.push({path:n,tuple:e}),f.hasChildren&&(r.expanded===!1&&(m=0,r.children=0),s={className:"k-icon "+(m?Lt:Ft)},s[ut.attr("path")]=n,x.push(nt("span",s))),x.push(this._content(f,e)),a=b.allCell&&!m?"k-grid-footer":"",c=this._cell(a,x,f),c.levelNum=v,b.children.push(c),b.colSpan["dim"+t]=c,(!this[_]||v>this[_])&&(this[_]=v),m){for(b.allCell=!1,b.hasChild=!1,d=0;m>d;d++)i=this._buildRows(g[d],t),b!==i&&(b.rowSpan+=i.rowSpan);b.rowSpan>1&&(c.attr.rowSpan=b.rowSpan),r.children=b.rowSpan,l=this._cell("k-grid-footer",[this._content(f,e)],f),l.levelNum=v,o=this._row([l]),o.colSpan["dim"+t]=l,o.allCell=!0,h[w+f.name+"all"]=o,p&&(i=this._buildRows(e,t+1),l.attr.rowSpan=i.rowSpan),b.rowSpan+=o.rowSpan,r.members=o.rowSpan}else p&&(b.hasChild=!1,this._buildRows(e,t+1),(l||c).attr.rowSpan=b.rowSpan,r.members=b.rowSpan);return r.children>r.maxChildren&&(r.maxChildren=r.children),r.members>r.maxMembers&&(r.maxMembers=r.members),b}}),dt=pt.extend({init:function(){this.columnAxis={},this.rowAxis={}},build:function(e,n,i){var o,r,a=n.indexes[0],s=n.metadata[a?a.path:t];return this.columnAxis=n,this.rowAxis=i,this.data=e,this.rowLength=s?s.maxChildren+s.maxMembers:n.measures.length||1,this.rowLength||(this.rowLength=1),o=this._tbody(),r=this._colGroup(),[nt("table",null,[r,o])]},_colGroup:function(){var e=this.columnAxis.measures.length||1,t=[],n=0;for(this.rows[0]&&(e=this.rows[0].children.length);e>n;n++)t.push(nt("col",null));return nt("colgroup",null,t)},_tbody:function(){return this.rows=[],this.data[0]?(this.columnIndexes=this._indexes(this.columnAxis,this.rowLength),this.rowIndexes=this._indexes(this.rowAxis,Math.ceil(this.data.length/this.rowLength)),this._buildRows()):this.rows.push(nt("tr",null,[nt("td",null,[it("&nbsp;")])])),nt("tbody",null,this.rows)},_indexes:function(e,n){var i,o,r,a,s,l=[],c=e.indexes,d=e.metadata,h=e.measures,u=h.length||1,f=0,p=0,g=0,m=c.length;if(!m){for(r=0;u>r;r++)l[r]={index:r,measure:h[r],tuple:null};return l}for(;m>g;g++){if(i=c[g],o=d[i.path],a=o.children+o.members,s=0,a&&(a-=u),o.expanded===!1&&o.children!==o.maxChildren&&(s=o.maxChildren),o.parentMember&&0===o.levelNum&&(a=-1),a>-1){for(r=0;u>r;r++)l[a+p+r]={children:a,index:f,measure:h[r],tuple:i.tuple},f+=1;for(;l[p]!==t;)p+=1}if(p===n)break;f+=s}return l},_buildRows:function(){for(var e=this.rowIndexes,t=e.length,n=0;t>n;n++)this.rows.push(this._buildRow(e[n]))},_buildRow:function(e){for(var t,n,i,o,r,a,s,l=e.index*this.rowLength,c=this.columnIndexes,d=c.length,h=[],u=0;d>u;u++)t=c[u],r={},t.children&&(r.className="k-alt"),o="",a=this.data[l+t.index],s=t.measure||e.measure,n={columnTuple:t.tuple,rowTuple:e.tuple,measure:s,dataItem:a},""!==a.value&&s&&s.type&&("status"===s.type?o=this.kpiStatusTemplate(n):"trend"===s.type&&(o=this.kpiTrendTemplate(n))),o||(o=this.dataTemplate(n)),i=nt("td",r,[it(o)]),i.value=a.value,h.push(i);return r={},e.children&&(r.className="k-grid-footer"),nt("tr",r,h)}}),ft.plugin(tt),ut.PivotExcelExporter=ut.Class.extend({init:function(e){this.options=e,this.widget=e.widget,this.dataSource=this.widget.dataSource},_columns:function(){var e,t=this.widget.columnsHeaderTree.children[0],n=this.widget.rowsHeaderTree.children[0],i=t.children[0].children.length,o=n.children[0].children.length,r=this.widget.options.columnWidth,a=[];if(o&&this.dataSource.data()[0])for(e=0;o>e;e++)a.push({autoWidth:!0});for(e=0;i>e;e++)a.push({autoWidth:!1,width:r});return a},_cells:function(e,t,n){for(var i,o,r,a,s,l=[],c=0,d=e.length;d>c;c++){for(o=[],r=e[c].children,i=r.length,a=0;i>a;a++)s=r[a],o.push({background:"#7a7a7a",color:"#fff",value:s.value,colSpan:s.attr.colSpan||1,rowSpan:s.attr.rowSpan||1});n&&n(o,c),l.push({cells:o,type:t})}return l},_rows:function(){var e,t,n=this.widget.columnsHeaderTree.children[0],i=this.widget.rowsHeaderTree.children[0],o=n.children[0].children.length,r=i.children[0].children.length,a=n.children[1].children,s=i.children[1].children,l=this.widget.contentTree.children[0].children[1].children,c=this._cells(a,"header");return r&&c[0].cells.splice(0,0,{background:"#7a7a7a",color:"#fff",value:"",colSpan:r,rowSpan:a.length}),e=function(e,t){for(var n,i,r=0,a=l[t].children;o>r;r++)n=a[r],i=+n.value,isNaN(i)&&(i=""),e.push({background:"#dfdfdf",color:"#333",value:i,colSpan:1,rowSpan:1})},t=this._cells(s,"data",e),c.concat(t)},_freezePane:function(){var e=this.widget.columnsHeaderTree.children[0],t=this.widget.rowsHeaderTree.children[0],n=t.children[0].children.length,i=e.children[1].children;return{colSplit:n,rowSplit:i.length}},workbook:function(){var t;return this.dataSource.view()[0]?(t=e.Deferred(),t.resolve()):t=this.dataSource.fetch(),t.then(e.proxy(function(){return{sheets:[{columns:this._columns(),rows:this._rows(),freezePane:this._freezePane(),filter:null}]}},this))}}),ht={extend:function(t){t.events.push("excelExport"),t.options.excel=e.extend(t.options.excel,this.options),t.saveAsExcel=this.saveAsExcel},options:{proxyURL:"",filterable:!1,fileName:"Export.xlsx"},saveAsExcel:function(){var t=this.options.excel||{},n=new ut.PivotExcelExporter({widget:this});n.workbook().then(e.proxy(function(e){if(!this.trigger("excelExport",{workbook:e})){var n=new ut.ooxml.Workbook(e);ut.saveAs({dataURI:n.toDataURL(),fileName:e.fileName||t.fileName,proxyURL:t.proxyURL,forceProxy:t.forceProxy})}},this))}},ut.PivotExcelMixin=ht,ut.ooxml&&ut.ooxml.Workbook&&ht.extend(tt.prototype),ut.PDFMixin&&(ut.PDFMixin.extend(tt.prototype),tt.fn._drawPDF=function(){return this._drawPDFShadow({width:this.wrapper.width()})})}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});