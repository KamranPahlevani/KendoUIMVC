/*
* Kendo UI v2015.2.902 (http://www.telerik.com/kendo-ui)
* Copyright 2015 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(e,define){define(["./kendo.data.min","./kendo.userevents.min","./kendo.dataviz.themes.min"],e)}(function(){return function(e,t){function i(e,t){if(null===t)return t;var i=b(e,!0);return i(t)}function n(e){return typeof e!==M}function o(e,t,i){var n,o,l=a(e),c=a(t),h=d(e)-d(t)<0,u=[];for(u.push(e),n=0;i>n;n++)o={r:r(l.r,c.r,n,i,h),g:r(l.g,c.g,n,i,h),b:r(l.b,c.b,n,i,h)},u.push(s(o));return u.push(t),u}function r(e,t,i,n,o){var r,s=f.min(f.abs(e),f.abs(t)),a=f.max(f.abs(e),f.abs(t)),l=(a-s)/(n+1),c=l*(i+1);return r=o?s+c:a-c}function s(e){return"#"+l(e.r)+l(e.g)+l(e.b)}function a(e){e=e.replace("#","");var t=c(e);return{r:h(t.r),g:h(t.g),b:h(t.b)}}function l(e){var t=f.round(e).toString(16).toUpperCase();return 1===t.length&&(t="0"+t),t}function c(e){var t=e.length,i={};return 3===t?(i.r=e[0],i.g=e[1],i.b=e[2]):(i.r=e.substring(0,2),i.g=e.substring(2,4),i.b=e.substring(4,6)),i}function h(e){return parseInt(e.toString(16),16)}function d(e){var t=0;return e&&(e=a(e),t=f.sqrt(.241*e.r*e.r+.691*e.g*e.g+.068*e.b*e.b)),t}function u(e){var t=f.pow(10,4);return f.round(e*t)/t}var f=Math,p=e.proxy,g=window.kendo,m=g.Class,v=g.ui.Widget,_=g.template,w=g.deepExtend,y=g.data.HierarchicalDataSource,b=g.getter,x=g.dataviz,k=".kendoTreeMap",C="change",S="dataBound",T="itemCreated",D=Number.MAX_VALUE,A="mouseover"+k,P="mouseleave"+k,M="undefined",E=v.extend({init:function(t,i){g.destroy(t),e(t).empty(),v.fn.init.call(this,t,i),this.wrapper=this.element,this._initTheme(this.options),this.element.addClass("k-widget k-treemap"),this._setLayout(),this._originalOptions=w({},this.options),this._initDataSource(),this._attachEvents(),g.notify(this,x.ui)},options:{name:"TreeMap",theme:"default",autoBind:!0,textField:"text",valueField:"value",colorField:"color"},events:[S,T],_initTheme:function(e){var t=this,i=x.ui.themes||{},n=((e||{}).theme||"").toLowerCase(),o=(i[n]||{}).treeMap;t.options=w({},o,e)},_attachEvents:function(){this.element.on(A,p(this._mouseover,this)).on(P,p(this._mouseleave,this))},_setLayout:function(){"horizontal"===this.options.type?(this._layout=new L(!1),this._view=new z(this,this.options)):"vertical"===this.options.type?(this._layout=new L(!0),this._view=new z(this,this.options)):(this._layout=new I,this._view=new B(this,this.options))},_initDataSource:function(){var e=this,t=e.options,i=t.dataSource;e._dataChangeHandler=p(e._onDataChange,e),e.dataSource=y.create(i).bind(C,e._dataChangeHandler),i&&e.options.autoBind&&e.dataSource.fetch()},setDataSource:function(e){var t=this;t.dataSource.unbind(C,t._dataChangeHandler),t.dataSource=e.bind(C,t._dataChangeHandler),e&&t.options.autoBind&&t.dataSource.fetch()},_onDataChange:function(e){var t,i,r,s,a,l,c=e.node,h=e.items,d=this.options;if(c){if(h.length){for(s=this._getByUid(c.uid),s.children=[],r=n(s.minColor)||n(s.maxColor)?o(s.minColor,s.maxColor,h.length)||[]:d.colors||[],i=0;h.length>i;i++)t=h[i],s.children.push(this._wrapItem(t));for(a=this._view.htmlSize(s),this._layout.compute(s.children,s.coord,a),i=0;s.children.length>i;i++)t=s.children[i],n(t.color)||("string"==typeof r[0]?t.color=r[i%r.length]:(l=r[i%r.length],l&&(t.color=l[0],t.minColor=l[0],t.maxColor=l[1])));this._view.render(s)}}else this.element.empty(),t=this._wrapItem(h[0]),this._layout.createRoot(t,this.element.outerWidth(),this.element.outerHeight(),"vertical"===this.options.type),this._view.createRoot(t),this._root=t;for(i=0;h.length>i;i++)h[i].load();c&&this.trigger(S,{node:c})},_contentSize:function(e){this.view.renderHeight(e)},_wrapItem:function(e){var t={};return n(this.options.valueField)&&(t.value=i(this.options.valueField,e)),n(this.options.colorField)&&(t.color=i(this.options.colorField,e)),n(this.options.textField)&&(t.text=i(this.options.textField,e)),t.level=e.level(),t.dataItem=e,t},_getByUid:function(e){for(var t,i=[this._root];i.length;){if(t=i.pop(),t.dataItem.uid===e)return t;t.children&&(i=i.concat(t.children))}},dataItem:function(t){var i=e(t).attr(g.attr("uid")),n=this.dataSource;return n&&n.getByUid(i)},findByUid:function(e){return this.element.find(".k-treemap-tile["+g.attr("uid")+"='"+e+"']")},_mouseover:function(t){var i=e(t.target);i.hasClass("k-leaf")&&(this._removeActiveState(),i.removeClass("k-state-hover").addClass("k-state-hover"))},_removeActiveState:function(){this.element.find(".k-state-hover").removeClass("k-state-hover")},_mouseleave:function(){this._removeActiveState()},destroy:function(){v.fn.destroy.call(this),this.element.off(k),this.dataSource&&this.dataSource.unbind(C,this._dataChangeHandler),this._root=null,g.destroy(this.element)},items:function(){return e()},getSize:function(){return g.dimensions(this.element)},_resize:function(){this.dataSource.fetch()},setOptions:function(e){var i=e.dataSource;e.dataSource=t,this._originalOptions=w(this._originalOptions,e),this.options=w({},this._originalOptions),this._setLayout(),this._initTheme(this.options),v.fn._setEvents.call(this,e),i&&this.setDataSource(y.create(i)),this.options.autoBind&&this.dataSource.fetch()}}),I=m.extend({createRoot:function(e,t,i){e.coord={width:t,height:i,top:0,left:0}},leaf:function(e){return!e.children},layoutChildren:function(e,t){var i,n,o,r,s=t.width*t.height,a=0,l=[];for(i=0;e.length>i;i++)l[i]=parseFloat(e[i].value),a+=l[i];for(i=0;l.length>i;i++)e[i].area=s*l[i]/a;n=this.layoutHorizontal()?t.height:t.width,e=new g.data.Query(e)._sortForGrouping("value","desc"),o=[e[0]],r=e.slice(1),this.squarify(r,o,n,t)},squarify:function(e,t,i,n){this.computeDim(e,t,i,n)},computeDim:function(e,i,n,o){var r,s,a;return e.length+i.length==1?(r=1==e.length?e:i,this.layoutLast(r,n,o),t):(e.length>=2&&0===i.length&&(i=[e[0]],e=e.slice(1)),0===e.length?(i.length>0&&this.layoutRow(i,n,o),t):(s=e[0],this.worstAspectRatio(i,n)>=this.worstAspectRatio([s].concat(i),n)?this.computeDim(e.slice(1),i.concat([s]),n,o):(a=this.layoutRow(i,n,o),this.computeDim(e,[],a.dim,a)),t))},layoutLast:function(e,t,i){e[0].coord=i},layoutRow:function(e,t,i){return this.layoutHorizontal()?this.layoutV(e,t,i):this.layoutH(e,t,i)},orientation:"h",layoutVertical:function(){return"v"===this.orientation},layoutHorizontal:function(){return"h"===this.orientation},layoutChange:function(){this.orientation=this.layoutVertical()?"h":"v"},worstAspectRatio:function(e,t){var i,n,o,r,s;if(!e||0===e.length)return D;for(i=0,n=0,o=D,r=0;e.length>r;r++)s=e[r].area,i+=s,o=s>o?o:s,n=n>s?n:s;return f.max(t*t*n/(i*i),i*i/(t*t*o))},compute:function(e,t,i){if(t.width>=t.height&&this.layoutHorizontal()||this.layoutChange(),e&&e.length>0){var n={width:t.width,height:t.height-i.text,top:0,left:0};this.layoutChildren(e,n)}},layoutV:function(e,t,i){var n,o,r,s=this._totalArea(e),a=0;for(t=u(s/t),n=0;e.length>n;n++)o=u(e[n].area/t),e[n].coord={height:o,width:t,top:i.top+a,left:i.left},a+=o;return r={height:i.height,width:i.width-t,top:i.top,left:i.left+t},r.dim=f.min(r.width,r.height),r.dim!=r.height&&this.layoutChange(),r},layoutH:function(e,t,i){var n,o,r=this._totalArea(e),s=u(r/t),a=i.top,l=0;for(n=0;e.length>n;n++)e[n].coord={height:s,width:u(e[n].area/s),top:a,left:i.left+l},l+=e[n].coord.width;return o={height:i.height-s,width:i.width,top:i.top+s,left:i.left},o.dim=f.min(o.width,o.height),o.dim!=o.width&&this.layoutChange(),o},_totalArea:function(e){var t,i=0;for(t=0;e.length>t;t++)i+=e[t].area;return i}}),B=m.extend({init:function(t,i){this.options=w({},this.options,i),this.treeMap=t,this.element=e(t.element),this.offset=0},htmlSize:function(e){var t,i,n=this._getByUid(e.dataItem.uid),o={text:0};return e.children&&(this._clean(n),t=this._getText(e),t&&(i=this._createTitle(e),n.append(i),o.text=i.height()),n.append(this._createWrap()),this.offset=(n.outerWidth()-n.innerWidth())/2),o},_getByUid:function(e){return this.element.find(".k-treemap-tile["+g.attr("uid")+"='"+e+"']")},render:function(e){var t,i,n,o,r=this._getByUid(e.dataItem.uid),s=e.children;if(s)for(t=r.find(".k-treemap-wrap"),i=0;s.length>i;i++)n=s[i],o=this._createLeaf(n),t.append(o),this.treeMap.trigger(T,{element:o})},createRoot:function(e){var t=this._createLeaf(e);this.element.append(t),this.treeMap.trigger(T,{element:t})},_clean:function(e){e.css("background-color",""),e.removeClass("k-leaf"),e.removeClass("k-inverse"),e.empty()},_createLeaf:function(t){return this._createTile(t).css("background-color",t.color).addClass("k-leaf").toggleClass("k-inverse",this._tileColorBrightness(t)>180).append(e("<div></div>").html(this._getText(t)))},_createTile:function(t){var i,o={width:t.coord.width,height:t.coord.height,left:t.coord.left,top:t.coord.top};return o.width+=o.left&&this.offset?2*this.offset:this.offset,o.height+=o.top?2*this.offset:this.offset,i=e("<div class='k-treemap-tile'></div>").css({width:o.width,height:o.height,left:o.left,top:o.top}),n(t.dataItem)&&n(t.dataItem.uid)&&i.attr(g.attr("uid"),t.dataItem.uid),i},_getText:function(e){var t=e.text;return this.options.template&&(t=this._renderTemplate(e)),t},_renderTemplate:function(e){var t=_(this.options.template);return t({dataItem:e.dataItem,text:e.text})},_createTitle:function(t){return e("<div class='k-treemap-title'></div>").append(e("<div></div>").html(this._getText(t)))},_createWrap:function(){return e("<div class='k-treemap-wrap'></div>")},_tileColorBrightness:function(e){return d(e.color)}}),L=m.extend({createRoot:function(e,t,i,n){e.coord={width:t,height:i,top:0,left:0},e.vertical=n},init:function(e){this.vertical=e,this.quotient=e?1:0},compute:function(e,t,i){var n,o,r;e.length>0&&(n=t.width,o=t.height,this.vertical?o-=i.text:n-=i.text,r={width:n,height:o,top:0,left:0},this.layoutChildren(e,r))},layoutChildren:function(e,t){var i,n,o=t.width*t.height,r=0,s=[];for(i=0;e.length>i;i++)n=e[i],s[i]=parseFloat(e[i].value),r+=s[i],n.vertical=this.vertical;for(i=0;s.length>i;i++)e[i].area=o*s[i]/r;e=new g.data.Query(e)._sortForGrouping("value","desc"),this.sliceAndDice(e,t)},sliceAndDice:function(e,t){var i=this._totalArea(e);e[0].level%2===this.quotient?this.layoutHorizontal(e,t,i):this.layoutVertical(e,t,i)},layoutHorizontal:function(e,t,i){var n,o,r,s=0;for(n=0;e.length>n;n++)o=e[n],r=o.area/(i/t.width),o.coord={height:t.height,width:r,top:t.top,left:t.left+s},s+=r},layoutVertical:function(e,t,i){var n,o,r,s=0;for(n=0;e.length>n;n++)o=e[n],r=o.area/(i/t.height),o.coord={height:r,width:t.width,top:t.top+s,left:t.left},s+=r},_totalArea:function(e){var t,i=0;for(t=0;e.length>t;t++)i+=e[t].area;return i}}),z=B.extend({htmlSize:function(e){var t,i,n=this._getByUid(e.dataItem.uid),o={text:0,offset:0};return e.children&&(this._clean(n),t=this._getText(e),t&&(i=this._createTitle(e),n.append(i),o.text=e.vertical?i.height():i.width()),n.append(this._createWrap()),this.offset=(n.outerWidth()-n.innerWidth())/2),o},_createTitle:function(t){var i;return i=e(t.vertical?"<div class='k-treemap-title'></div>":"<div class='k-treemap-title-vertical'></div>"),i.append(e("<div></div>").html(this._getText(t)))}});x.ui.plugin(E)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});