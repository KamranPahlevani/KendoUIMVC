/*
* Kendo UI v2014.3.1119 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(t,define){define(["./kendo.data.min","./kendo.userevents.min","./kendo.dataviz.themes.min"],t)}(function(){return function(t,e){function n(t,e){if(null===e)return e;var n=b(t,!0);return n(e)}function i(t){return typeof t!==M}function o(t,e,n){var i,o,l=s(t),c=s(e),h=d(t)-d(e)<0,u=[];for(u.push(t),i=0;n>i;i++)o={r:r(l.r,c.r,i,n,h),g:r(l.g,c.g,i,n,h),b:r(l.b,c.b,i,n,h)},u.push(a(o));return u.push(e),u}function r(t,e,n,i,o){var r,a=f.min(f.abs(t),f.abs(e)),s=f.max(f.abs(t),f.abs(e)),l=(s-a)/(i+1),c=l*(n+1);return r=o?a+c:s-c}function a(t){return"#"+l(t.r)+l(t.g)+l(t.b)}function s(t){t=t.replace("#","");var e=c(t);return{r:h(e.r),g:h(e.g),b:h(e.b)}}function l(t){var e=f.round(t).toString(16).toUpperCase();return 1===e.length&&(e="0"+e),e}function c(t){var e=t.length,n={};return 3===e?(n.r=t[0],n.g=t[1],n.b=t[2]):(n.r=t.substring(0,2),n.g=t.substring(2,4),n.b=t.substring(4,6)),n}function h(t){return parseInt(t.toString(16),16)}function d(t){var e=0;return t&&(t=s(t),e=f.sqrt(.241*t.r*t.r+.691*t.g*t.g+.068*t.b*t.b)),e}function u(t){var e=f.pow(10,4);return f.round(t*e)/e}var f=Math,p=t.proxy,g=window.kendo,m=g.Class,v=g.ui.Widget,_=g.template,w=g.deepExtend,y=g.data.HierarchicalDataSource,b=g.getter,x=g.dataviz,k=".kendoTreeMap",C="change",S="dataBound",T="itemCreated",D=Number.MAX_VALUE,A="mouseover"+k,P="mouseleave"+k,M="undefined",E=v.extend({init:function(e,n){g.destroy(e),t(e).empty(),v.fn.init.call(this,e,n),this._initTheme(this.options),this.element.addClass("k-widget k-treemap"),this._setLayout(),this._originalOptions=w({},this.options),this._initDataSource(),this._attachEvents(),g.notify(this,x.ui)},options:{name:"TreeMap",theme:"default",autoBind:!0,textField:"text",valueField:"value",colorField:"color"},events:[S,T],_initTheme:function(t){var e=this,n=x.ui.themes||{},i=((t||{}).theme||"").toLowerCase(),o=(n[i]||{}).treeMap;e.options=w({},o,t)},_attachEvents:function(){this.element.on(A,p(this._mouseover,this)).on(P,p(this._mouseleave,this))},_setLayout:function(){"horizontal"===this.options.type?(this._layout=new L(!1),this._view=new z(this,this.options)):"vertical"===this.options.type?(this._layout=new L(!0),this._view=new z(this,this.options)):(this._layout=new I,this._view=new B(this,this.options))},_initDataSource:function(){var t=this,e=t.options,n=e.dataSource;t._dataChangeHandler=p(t._onDataChange,t),t.dataSource=y.create(n).bind(C,t._dataChangeHandler),n&&t.options.autoBind&&t.dataSource.fetch()},setDataSource:function(t){var e=this;e.dataSource.unbind(C,e._dataChangeHandler),e.dataSource=t.bind(C,e._dataChangeHandler),t&&e.options.autoBind&&e.dataSource.fetch()},_onDataChange:function(t){var e,n,r,a,s,l,c=t.node,h=t.items,d=this.options;if(c){if(h.length){for(a=this._getByUid(c.uid),a.children=[],r=i(a.minColor)||i(a.maxColor)?o(a.minColor,a.maxColor,h.length)||[]:d.colors||[],n=0;h.length>n;n++)e=h[n],a.children.push(this._wrapItem(e));for(s=this._view.htmlSize(a),this._layout.compute(a.children,a.coord,s),n=0;a.children.length>n;n++)e=a.children[n],i(e.color)||("string"==typeof r[0]?e.color=r[n%r.length]:(l=r[n%r.length],l&&(e.color=l[0],e.minColor=l[0],e.maxColor=l[1])));this._view.render(a)}}else this.element.empty(),e=this._wrapItem(h[0]),this._layout.createRoot(e,this.element.outerWidth(),this.element.outerHeight(),"vertical"===this.options.type),this._view.createRoot(e),this._root=e;for(n=0;h.length>n;n++)h[n].load();c&&this.trigger(S,{node:c})},_contentSize:function(t){this.view.renderHeight(t)},_wrapItem:function(t){var e={};return i(this.options.valueField)&&(e.value=n(this.options.valueField,t)),i(this.options.colorField)&&(e.color=n(this.options.colorField,t)),i(this.options.textField)&&(e.text=n(this.options.textField,t)),e.level=t.level(),e.dataItem=t,e},_getByUid:function(t){for(var e,n=[this._root];n.length;){if(e=n.pop(),e.dataItem.uid===t)return e;e.children&&(n=n.concat(e.children))}},dataItem:function(e){var n=t(e).attr(g.attr("uid")),i=this.dataSource;return i&&i.getByUid(n)},findByUid:function(t){return this.element.find(".k-treemap-tile["+g.attr("uid")+"='"+t+"']")},_mouseover:function(e){var n=t(e.target);n.hasClass("k-leaf")&&(this._removeActiveState(),n.removeClass("k-state-hover").addClass("k-state-hover"))},_removeActiveState:function(){this.element.find(".k-state-hover").removeClass("k-state-hover")},_mouseleave:function(){this._removeActiveState()},destroy:function(){v.fn.destroy.call(this),this.element.off(k),this.dataSource&&this.dataSource.unbind(C,this._dataChangeHandler),this._root=null,g.destroy(this.element)},items:function(){return t()},getSize:function(){return g.dimensions(this.element)},_resize:function(){this.dataSource.fetch()},setOptions:function(t){var n=t.dataSource;t.dataSource=e,this._originalOptions=w(this._originalOptions,t),this.options=w({},this._originalOptions),this._setLayout(),this._initTheme(this.options),v.fn._setEvents.call(this,t),n&&this.setDataSource(y.create(n)),this.options.autoBind&&this.dataSource.fetch()}}),I=m.extend({createRoot:function(t,e,n){t.coord={width:e,height:n,top:0,left:0}},leaf:function(t){return!t.children},layoutChildren:function(t,e){var n,i,o,r,a=e.width*e.height,s=0,l=[];for(n=0;t.length>n;n++)l[n]=parseFloat(t[n].value),s+=l[n];for(n=0;l.length>n;n++)t[n].area=a*l[n]/s;i=this.layoutHorizontal()?e.height:e.width,t=new g.data.Query(t)._sortForGrouping("value","desc"),o=[t[0]],r=t.slice(1),this.squarify(r,o,i,e)},squarify:function(t,e,n,i){this.computeDim(t,e,n,i)},computeDim:function(t,n,i,o){var r,a,s;return t.length+n.length==1?(r=1==t.length?t:n,this.layoutLast(r,i,o),e):(t.length>=2&&0===n.length&&(n=[t[0]],t=t.slice(1)),0===t.length?(n.length>0&&this.layoutRow(n,i,o),e):(a=t[0],this.worstAspectRatio(n,i)>=this.worstAspectRatio([a].concat(n),i)?this.computeDim(t.slice(1),n.concat([a]),i,o):(s=this.layoutRow(n,i,o),this.computeDim(t,[],s.dim,s)),e))},layoutLast:function(t,e,n){t[0].coord=n},layoutRow:function(t,e,n){return this.layoutHorizontal()?this.layoutV(t,e,n):this.layoutH(t,e,n)},orientation:"h",layoutVertical:function(){return"v"===this.orientation},layoutHorizontal:function(){return"h"===this.orientation},layoutChange:function(){this.orientation=this.layoutVertical()?"h":"v"},worstAspectRatio:function(t,e){var n,i,o,r,a;if(!t||0===t.length)return D;for(n=0,i=0,o=D,r=0;t.length>r;r++)a=t[r].area,n+=a,o=a>o?o:a,i=i>a?i:a;return f.max(e*e*i/(n*n),n*n/(e*e*o))},compute:function(t,e,n){if(e.width>=e.height&&this.layoutHorizontal()||this.layoutChange(),t&&t.length>0){var i={width:e.width,height:e.height-n.text,top:0,left:0};this.layoutChildren(t,i)}},layoutV:function(t,e,n){var i,o,r,a=this._totalArea(t),s=0;for(e=u(a/e),i=0;t.length>i;i++)o=u(t[i].area/e),t[i].coord={height:o,width:e,top:n.top+s,left:n.left},s+=o;return r={height:n.height,width:n.width-e,top:n.top,left:n.left+e},r.dim=f.min(r.width,r.height),r.dim!=r.height&&this.layoutChange(),r},layoutH:function(t,e,n){var i,o,r=this._totalArea(t),a=u(r/e),s=n.top,l=0;for(i=0;t.length>i;i++)t[i].coord={height:a,width:u(t[i].area/a),top:s,left:n.left+l},l+=t[i].coord.width;return o={height:n.height-a,width:n.width,top:n.top+a,left:n.left},o.dim=f.min(o.width,o.height),o.dim!=o.width&&this.layoutChange(),o},_totalArea:function(t){var e,n=0;for(e=0;t.length>e;e++)n+=t[e].area;return n}}),B=m.extend({init:function(e,n){this.options=w({},this.options,n),this.treeMap=e,this.element=t(e.element),this.offset=0},htmlSize:function(t){var e,n,i=this._getByUid(t.dataItem.uid),o={text:0};return t.children&&(this._clean(i),e=this._getText(t),e&&(n=this._createTitle(t),i.append(n),o.text=n.height()),i.append(this._createWrap()),this.offset=(i.outerWidth()-i.innerWidth())/2),o},_getByUid:function(t){return this.element.find(".k-treemap-tile["+g.attr("uid")+"='"+t+"']")},render:function(t){var e,n,i,o,r=this._getByUid(t.dataItem.uid),a=t.children;if(a)for(e=r.find(".k-treemap-wrap"),n=0;a.length>n;n++)i=a[n],o=this._createLeaf(i),e.append(o),this.treeMap.trigger(T,{element:o})},createRoot:function(t){var e=this._createLeaf(t);this.element.append(e),this.treeMap.trigger(T,{element:e})},_clean:function(t){t.css("background-color",""),t.removeClass("k-leaf"),t.removeClass("k-inverse"),t.empty()},_createLeaf:function(e){return this._createTile(e).css("background-color",e.color).addClass("k-leaf").toggleClass("k-inverse",this._tileColorBrightness(e)>180).append(t("<div></div>").html(this._getText(e)))},_createTile:function(e){var n,o={width:e.coord.width,height:e.coord.height,left:e.coord.left,top:e.coord.top};return o.width+=o.left&&this.offset?2*this.offset:this.offset,o.height+=o.top?2*this.offset:this.offset,n=t("<div class='k-treemap-tile'></div>").css({width:o.width,height:o.height,left:o.left,top:o.top}),i(e.dataItem)&&i(e.dataItem.uid)&&n.attr(g.attr("uid"),e.dataItem.uid),n},_getText:function(t){var e=t.text;return this.options.template&&(e=this._renderTemplate(t)),e},_renderTemplate:function(t){var e=_(this.options.template);return e({dataItem:t.dataItem,text:t.text})},_createTitle:function(e){return t("<div class='k-treemap-title'></div>").append(t("<div></div>").html(this._getText(e)))},_createWrap:function(){return t("<div class='k-treemap-wrap'></div>")},_tileColorBrightness:function(t){return d(t.color)}}),L=m.extend({createRoot:function(t,e,n,i){t.coord={width:e,height:n,top:0,left:0},t.vertical=i},init:function(t){this.vertical=t,this.quotient=t?1:0},compute:function(t,e,n){var i,o,r;t.length>0&&(i=e.width,o=e.height,this.vertical?o-=n.text:i-=n.text,r={width:i,height:o,top:0,left:0},this.layoutChildren(t,r))},layoutChildren:function(t,e){var n,i,o=e.width*e.height,r=0,a=[];for(n=0;t.length>n;n++)i=t[n],a[n]=parseFloat(t[n].value),r+=a[n],i.vertical=this.vertical;for(n=0;a.length>n;n++)t[n].area=o*a[n]/r;t=new g.data.Query(t)._sortForGrouping("value","desc"),this.sliceAndDice(t,e)},sliceAndDice:function(t,e){var n=this._totalArea(t);t[0].level%2===this.quotient?this.layoutHorizontal(t,e,n):this.layoutVertical(t,e,n)},layoutHorizontal:function(t,e,n){var i,o,r,a=0;for(i=0;t.length>i;i++)o=t[i],r=o.area/(n/e.width),o.coord={height:e.height,width:r,top:e.top,left:e.left+a},a+=r},layoutVertical:function(t,e,n){var i,o,r,a=0;for(i=0;t.length>i;i++)o=t[i],r=o.area/(n/e.height),o.coord={height:r,width:e.width,top:e.top+a,left:e.left},a+=r},_totalArea:function(t){var e,n=0;for(e=0;t.length>e;e++)n+=t[e].area;return n}}),z=B.extend({htmlSize:function(t){var e,n,i=this._getByUid(t.dataItem.uid),o={text:0,offset:0};return t.children&&(this._clean(i),e=this._getText(t),e&&(n=this._createTitle(t),i.append(n),o.text=t.vertical?n.height():n.width()),i.append(this._createWrap()),this.offset=(i.outerWidth()-i.innerWidth())/2),o},_createTitle:function(e){var n;return n=t(e.vertical?"<div class='k-treemap-title'></div>":"<div class='k-treemap-title-vertical'></div>"),n.append(t("<div></div>").html(this._getText(e)))}});x.ui.plugin(E)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(t,e){e()});