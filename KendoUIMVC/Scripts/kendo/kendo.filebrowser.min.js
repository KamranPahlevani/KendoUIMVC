/*
* Kendo UI v2014.3.1119 (http://www.telerik.com/kendo-ui)
* Copyright 2014 Telerik AD. All rights reserved.
*
* Kendo UI commercial licenses may be obtained at
* http://www.telerik.com/purchase/license-agreement/kendo-ui-complete
* If you do not own a commercial license, this file shall be governed by the trial license terms.
*/
!function(t,define){define(["./kendo.listview.min","./kendo.dropdownlist.min","./kendo.upload.min"],t)}(function(){return function(t,e){function n(t,e,n){var i,o;t.on("dragenter"+k,function(){e(),o=new Date,i||(i=setInterval(function(){var t=new Date-o;t>100&&(n(),clearInterval(i),i=null)},100))}).on("dragover"+k,function(){o=new Date})}function i(t,n){return t!==e&&t.match(/\/$/)||(t=(t||"")+"/"),t+n}function o(t){if(!t)return"";var e=" bytes";return t>=1073741824?(e=" GB",t/=1073741824):t>=1048576?(e=" MB",t/=1048576):t>=1024&&(e=" KB",t/=1024),Math.round(100*t)/100+e}function r(t,e){var n=t[e];return u(n)?n.from||n.field||e:n}var a,s,l,c,h=window.kendo,d=h.ui.Widget,u=t.isPlainObject,f=t.proxy,p=t.extend,g=h.support.placeholder,m=h.support.browser,v=h.isFunction,_=/(^\/|\/$)/g,w="change",y="apply",b="error",x="click",k=".kendoFileBrowser",C=".kendoBreadcrumbs",S=".kendoSearchBox",T="name",A="size",D="type",P={field:D,dir:"asc"},E=h.template('<li class="k-tile-empty"><strong>${text}</strong></li>'),M='<div class="k-widget k-filebrowser-toolbar k-header k-floatwrap"><div class="k-toolbar-wrap"># if (showUpload) { # <div class="k-widget k-upload"><div class="k-button k-button-icontext k-upload-button"><span class="k-icon k-add"></span>#=messages.uploadFile#<input type="file" name="file" /></div></div># } ## if (showCreate) { #<button type="button" class="k-button k-button-icon"><span class="k-icon k-addfolder" /></button># } ## if (showDelete) { #<button type="button" class="k-button k-button-icon k-state-disabled"><span class="k-icon k-delete" /></button>&nbsp;# } #</div><div class="k-tiles-arrange"><label>#=messages.orderBy#: <select /></label></a></div></div>';p(!0,h.data,{schemas:{filebrowser:{data:function(t){return t.items||t||[]},model:{id:"name",fields:{name:"name",size:"size",type:"type"}}}}}),p(!0,h.data,{transports:{filebrowser:h.data.RemoteTransport.extend({init:function(e){h.data.RemoteTransport.fn.init.call(this,t.extend(!0,{},this.options,e))},_call:function(e,n){n.data=t.extend({},n.data,{path:this.options.path()}),v(this.options[e])?this.options[e].call(this,n):h.data.RemoteTransport.fn[e].call(this,n)},read:function(t){this._call("read",t)},create:function(t){this._call("create",t)},destroy:function(t){this._call("destroy",t)},update:function(){},options:{read:{type:"POST"},update:{type:"POST"},create:{type:"POST"},destroy:{type:"POST"}}})}}),a=m.msie&&8>m.version?function(t){return t.offsetTop}:function(e){return e.offsetTop-t(e).height()},s=d.extend({init:function(t,e){var n=this;e=e||{},d.fn.init.call(n,t,e),n.element.addClass("k-filebrowser"),n.element.on(x+k,".k-filebrowser-toolbar button:not(.k-state-disabled):has(.k-delete)",f(n._deleteClick,n)).on(x+k,".k-filebrowser-toolbar button:not(.k-state-disabled):has(.k-addfolder)",f(n._addClick,n)).on("keydown"+k,"li.k-state-selected input",f(n._directoryKeyDown,n)).on("blur"+k,"li.k-state-selected input",f(n._directoryBlur,n)),n._dataSource(),n.refresh(),n.path(n.options.path)},options:{name:"FileBrowser",messages:{uploadFile:"Upload",orderBy:"Arrange by",orderByName:"Name",orderBySize:"Size",directoryNotFound:"A directory with this name was not found.",emptyFolder:"Empty Folder",deleteFile:'Are you sure you want to delete "{0}"?',invalidFileType:'The selected file "{0}" is not valid. Supported file types are {1}.',overwriteFile:'A file with name "{0}" already exists in the current directory. Do you want to overwrite it?',dropFilesHere:"drop file here to upload",search:"Search"},transport:{},path:"/",fileTypes:"*.*"},events:[b,w,y],destroy:function(){var t=this;d.fn.destroy.call(t),t.dataSource.unbind(b,t._errorHandler),t.element.add(t.list).add(t.toolbar).off(k),h.destroy(t.element)},value:function(){var t,n=this,o=n._selectedItem(),r=n.options.transport.fileUrl;return o&&"f"===o.get(D)?(t=i(n.path(),o.get(T)).replace(_,""),r&&(t=v(r)?r(t):h.format(r,encodeURIComponent(t))),t):e},_selectedItem:function(){var t=this.listView,n=t.select();return n.length?this.dataSource.getByUid(n.attr(h.attr("uid"))):e},_toolbar:function(){var e=this,n=h.template(M),i=e.options.messages,o=[{text:i.orderByName,value:"name"},{text:i.orderBySize,value:"size"}];e.toolbar=t(n({messages:i,showUpload:e.options.transport.uploadUrl,showCreate:e.options.transport.create,showDelete:e.options.transport.destroy})).appendTo(e.element).find(".k-upload input").kendoUpload({multiple:!1,localization:{dropFilesHere:i.dropFilesHere},async:{saveUrl:e.options.transport.uploadUrl,autoUpload:!0},upload:f(e._fileUpload,e),error:function(t){e._error({xhr:t.XMLHttpRequest,status:"error"})}}).end(),e.upload=e.toolbar.find(".k-upload input").data("kendoUpload"),e.arrangeBy=e.toolbar.find(".k-tiles-arrange select").kendoDropDownList({dataSource:o,dataTextField:"text",dataValueField:"value",change:function(){e.orderBy(this.value())}}).data("kendoDropDownList"),e._attachDropzoneEvents()},_attachDropzoneEvents:function(){var e=this;e.options.transport.uploadUrl&&(n(t(document.documentElement),t.proxy(e._dropEnter,e),t.proxy(e._dropLeave,e)),e._scrollHandler=f(e._positionDropzone,e))},_dropEnter:function(){this._positionDropzone(),t(document).on("scroll"+k,this._scrollHandler)},_dropLeave:function(){this._removeDropzone(),t(document).off("scroll"+k,this._scrollHandler)},_positionDropzone:function(){var t=this,e=t.element,n=e.offset();t.toolbar.find(".k-dropzone").addClass("k-filebrowser-dropzone").offset(n).css({width:e[0].clientWidth,height:e[0].clientHeight,lineHeight:e[0].clientHeight+"px"})},_removeDropzone:function(){this.toolbar.find(".k-dropzone").removeClass("k-filebrowser-dropzone").css({width:"",height:"",lineHeight:"",top:"",left:""})},_deleteClick:function(){var t=this,e=t.listView.select(),n=h.format(t.options.messages.deleteFile,e.find("strong").text());e.length&&t._showMessage(n,"confirm")&&t.listView.remove(e)},_addClick:function(){this.createDirectory()},_getFieldName:function(t){return r(this.dataSource.reader.model.fields,t)},_fileUpload:function(t){var e,n=this,i=n.options,o=i.fileTypes,r=RegExp(("("+o.split(",").join(")|(")+")").replace(/\*\./g,".*."),"i"),a=t.files[0].name,s=T,l=A;r.test(a)?(t.data={path:n.path()},e=n._createFile(a),e?n.upload.one("success",function(t){e.set(s,t.response[n._getFieldName(s)]),e.set(l,t.response[n._getFieldName(l)]),n._tiles=n.listView.items().filter("["+h.attr("type")+"=f]")}):t.preventDefault()):(t.preventDefault(),n._showMessage(h.format(i.messages.invalidFileType,a,o)))},_findFile:function(t){var e,n,i,o=this.dataSource.data(),r=D,a=T;for(t=t.toLowerCase(),e=0,i=o.length;i>e;e++)if("f"===o[e].get(r)&&o[e].get(a).toLowerCase()===t){n=o[e];break}return n},_createFile:function(t){var e,n,i=this,o=0,r={},a=D,s=i.dataSource.view(),l=i._findFile(t);if(l&&!i._showMessage(h.format(i.options.messages.overwriteFile,t),"confirm"))return null;if(l)return l;for(e=0,n=s.length;n>e;e++)if("f"===s[e].get(a)){o=e;break}return r[a]="f",r[T]=t,r[A]=0,i.dataSource.insert(++o,r)},createDirectory:function(){var t,e,n=this,i=0,o=D,r=T,a=n.dataSource.data(),s=n._nameDirectory(),l=new n.dataSource.reader.model;for(t=0,e=a.length;e>t;t++)"d"===a[t].get(o)&&(i=t);l.set(o,"d"),l.set(r,s),n.listView.one("dataBound",function(){var t=n.listView.items().filter("["+h.attr("uid")+"="+l.uid+"]"),e=t.find("input");t.length&&this.edit(t),this.element.scrollTop(t.attr("offsetTop")-this.element[0].offsetHeight),setTimeout(function(){e.select()})}).one("save",function(t){var e=t.model.get(r);e?t.model.set(r,n._nameExists(e,l.uid)?n._nameDirectory():e):t.model.set(r,s)}),n.dataSource.insert(++i,l)},_directoryKeyDown:function(t){13==t.keyCode&&t.currentTarget.blur()},_directoryBlur:function(){this.listView.save()},_nameExists:function(t,e){var n,i,o=this.dataSource.data(),r=D,a=T;for(n=0,i=o.length;i>n;n++)if("d"===o[n].get(r)&&o[n].get(a).toLowerCase()===t.toLowerCase()&&o[n].uid!==e)return!0;return!1},_nameDirectory:function(){var e,n,i,o="New folder",r=this.dataSource.data(),a=[],s=D,l=T;for(n=0,i=r.length;i>n;n++)"d"===r[n].get(s)&&r[n].get(l).toLowerCase().indexOf(o.toLowerCase())>-1&&a.push(r[n].get(l));if(t.inArray(o,a)>-1){n=2;do e=o+" ("+n+")",n++;while(t.inArray(e,a)>-1);o=e}return o},orderBy:function(t){this.dataSource.sort([{field:D,dir:"asc"},{field:t,dir:"asc"}])},search:function(t){this.dataSource.filter({field:T,operator:"contains",value:t})},_content:function(){var e=this;e.list=t('<ul class="k-reset k-floats k-tiles" />').appendTo(e.element).on("dblclick"+k,"li",f(e._dblClick,e)),e.listView=new h.ui.ListView(e.list,{dataSource:e.dataSource,template:e._itemTmpl(),editTemplate:e._editTmpl(),selectable:!0,autoBind:!1,dataBinding:function(t){e.toolbar.find(".k-delete").parent().addClass("k-state-disabled"),("remove"===t.action||"sync"===t.action)&&t.preventDefault()},dataBound:function(){e.dataSource.view().length?e._tiles=this.items().filter("["+h.attr("type")+"=f]"):this.wrapper.append(E({text:e.options.messages.emptyFolder}))},change:f(e._listViewChange,e)})},_dblClick:function(e){var n,o=this,r=t(e.currentTarget);r.hasClass("k-edit-item")&&o._directoryBlur(),r.filter("["+h.attr("type")+"=d]").length?(n=o.dataSource.getByUid(r.attr(h.attr("uid"))),n&&(o.path(i(o.path(),n.get(T))),o.breadcrumbs.value(o.path()))):r.filter("["+h.attr("type")+"=f]").length&&o.trigger(y)},_listViewChange:function(){var t=this._selectedItem();t&&(this.toolbar.find(".k-delete").parent().removeClass("k-state-disabled"),"f"===t.get(D)&&this.trigger(w))},_dataSource:function(){var t,e=this,n=e.options,i=n.transport,o=p({},P),r={field:T,dir:"asc"},a={type:i.type||"filebrowser",sort:[o,r]};u(i)&&(i.path=f(e.path,e),a.transport=i),u(n.schema)?a.schema=n.schema:i.type&&u(h.data.schemas[i.type])&&(t=h.data.schemas[i.type]),e.dataSource&&e._errorHandler?e.dataSource.unbind(b,e._errorHandler):e._errorHandler=f(e._error,e),e.dataSource=h.data.DataSource.create(a).bind(b,e._errorHandler)},_navigation:function(){var e=this,n=t('<div class="k-floatwrap"><input/><input/></div>').appendTo(this.element);e.breadcrumbs=n.find("input:first").kendoBreadcrumbs({value:e.options.path,change:function(){e.path(this.value())}}).data("kendoBreadcrumbs"),e.searchBox=n.parent().find("input:last").kendoSearchBox({label:e.options.messages.search,change:function(){e.search(this.value())}}).data("kendoSearchBox")},_error:function(t){var e,n=this;n.trigger(b,t)||(e=t.xhr.status,"error"==t.status?"404"==e?n._showMessage(n.options.messages.directoryNotFound):"0"!=e&&n._showMessage("Error! The requested URL returned "+e+" - "+t.xhr.statusText):"timeout"==e&&n._showMessage("Error! Server timeout."))},_showMessage:function(t,e){return window[e||"alert"](t)},refresh:function(){var t=this;t._navigation(),t._toolbar(),t._content()},_editTmpl:function(){var t='<li class="k-tile k-state-selected" '+h.attr("uid")+'="#=uid#" ';return t+=h.attr("type")+'="${'+D+'}">',t+="#if("+D+' == "d") { #',t+='<div class="k-thumb"><span class="k-icon k-folder"></span></div>',t+="#}else{#",t+='<div class="k-thumb"><span class="k-icon k-loading"></span></div>',t+="#}#",t+="#if("+D+' == "d") { #',t+='<input class="k-input" '+h.attr("bind")+'="value:'+T+'"/>',t+="#}#",t+="</li>",f(h.template(t),{sizeFormatter:o})},_itemTmpl:function(){var t='<li class="k-tile" '+h.attr("uid")+'="#=uid#" ';return t+=h.attr("type")+'="${'+D+'}">',t+="#if("+D+' == "d") { #',t+='<div class="k-thumb"><span class="k-icon k-folder"></span></div>',t+="#}else{#",t+='<div class="k-thumb"><span class="k-icon k-file"></span></div>',t+="#}#",t+="<strong>${"+T+"}</strong>",t+="#if("+D+' == "f") { # <span class="k-filesize">${this.sizeFormatter('+A+")}</span> #}#",t+="</li>",f(h.template(t),{sizeFormatter:o})},path:function(t){var n=this,i=n._path||"";return t!==e?(n._path=t.replace(_,"")+"/",n.dataSource.read({path:n._path}),e):(i&&(i=i.replace(_,"")),"/"===i||""===i?"":i+"/")}}),l=d.extend({init:function(t,e){var n=this;e=e||{},d.fn.init.call(n,t,e),g&&n.element.attr("placeholder",n.options.label),n._wrapper(),n.element.on("keydown"+S,f(n._keydown,n)).on("change"+S,f(n._updateValue,n)),n.wrapper.on(x+S,"a",f(n._click,n)),g||n.element.on("focus"+S,f(n._focus,n)).on("blur"+S,f(n._blur,n))},options:{name:"SearchBox",label:"Search",value:""},events:[w],destroy:function(){var t=this;t.wrapper.add(t.element).add(t.label).off(S),d.fn.destroy.call(t)},_keydown:function(t){13===t.keyCode&&this._updateValue()},_click:function(t){t.preventDefault(),this._updateValue()},_updateValue:function(){var t=this,e=t.element.val();e!==t.value()&&(t.value(e),t.trigger(w))},_blur:function(){this._updateValue(),this._toggleLabel()},_toggleLabel:function(){g||this.label.toggle(!this.element.val())},_focus:function(){this.label.hide()},_wrapper:function(){var e=this.element,n=e.parents(".k-search-wrap");e[0].style.width="",e.addClass("k-input"),n.length||(n=e.wrap(t('<div class="k-widget k-search-wrap k-textbox"/>')).parent(),g||t('<label style="display:block">'+this.options.label+"</label>").insertBefore(e),t('<a href="#" class="k-icon k-i-search k-search"/>').appendTo(n)),this.wrapper=n,this.label=n.find(">label")},value:function(t){var n=this;return t!==e?(n.options.value=t,n.element.val(t),n._toggleLabel(),e):n.options.value}}),c=d.extend({init:function(t,e){var n=this;e=e||{},d.fn.init.call(n,t,e),n._wrapper(),n.wrapper.on("focus"+C,"input",f(n._focus,n)).on("blur"+C,"input",f(n._blur,n)).on("keydown"+C,"input",f(n._keydown,n)).on(x+C,"a.k-i-arrow-n:first",f(n._rootClick,n)).on(x+C,"a:not(.k-i-arrow-n)",f(n._click,n)),n.value(n.options.value)},options:{name:"Breadcrumbs",gap:50},events:[w],destroy:function(){var t=this;d.fn.destroy.call(t),t.wrapper.add(t.wrapper.find("input")).add(t.wrapper.find("a")).off(C)},_update:function(t){t="/"===(t||"").charAt(0)?t:"/"+(t||""),t!==this.value()&&(this.value(t),this.trigger(w))},_click:function(e){e.preventDefault(),this._update(this._path(t(e.target).prevAll("a:not(.k-i-arrow-n)").addBack()))},_rootClick:function(t){t.preventDefault(),this._update("")},_focus:function(){var t=this,e=t.element;t.overlay.hide(),t.element.val(t.value()),setTimeout(function(){e.select()})},_blur:function(){if(!this.overlay.is(":visible")){var t=this,e=t.element,n=e.val().replace(/\/{2,}/g,"/");t.overlay.show(),e.val(""),t._update(n)}},_keydown:function(t){var e=this;13===t.keyCode&&(e._blur(),setTimeout(function(){e.overlay.find("a:first").focus()}))},_wrapper:function(){var e,n=this.element,i=n.parents(".k-breadcrumbs");n[0].style.width="",n.addClass("k-input"),i.length||(i=n.wrap(t('<div class="k-widget k-breadcrumbs k-textbox"/>')).parent()),e=i.find(".k-breadcrumbs-wrap"),e.length||(e=t('<div class="k-breadcrumbs-wrap"/>').appendTo(i)),this.wrapper=i,this.overlay=e},refresh:function(){var n,i,o,r,a="",s=this.value();for(s!==e&&s.match(/^\//)||(s="/"+(s||"")),n=s.split("/"),o=0,r=n.length;r>o;o++)i=n[o],i&&(a||(a+='<a href="#" class="k-icon k-i-arrow-n">root</a>'),a+='<a class="k-link" href="#">'+n[o]+"</a>",a+='<span class="k-icon k-i-arrow-e">&gt;</span>');this.overlay.empty().append(t(a)),this._adjustSectionWidth()},_adjustSectionWidth:function(){var e,n=this,i=n.wrapper,o=i.width()-n.options.gap,r=n.overlay.find("a");r.each(function(n){e=t(this),e.parent().width()>o&&(n==r.length-1?e.width(o):e.prev().addBack().hide())})},value:function(t){return t!==e?(this._value=t.replace(/\/{2,}/g,"/"),this.refresh(),e):this._value},_path:function(e){return"/"+t.map(e,function(e){return t(e).text()}).join("/")}}),h.ui.plugin(s),h.ui.plugin(c),h.ui.plugin(l)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(t,e){e()});